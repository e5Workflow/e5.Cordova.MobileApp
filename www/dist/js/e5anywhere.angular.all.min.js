function base64ArrayBuffer(arrayBuffer){for(var a,b,c,d,chunk,base64="",encodings="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bytes=new Uint8Array(arrayBuffer),byteLength=bytes.byteLength,byteRemainder=byteLength%3,mainLength=byteLength-byteRemainder,i=0;i<mainLength;i+=3)chunk=bytes[i]<<16|bytes[i+1]<<8|bytes[i+2],a=(16515072&chunk)>>18,b=(258048&chunk)>>12,c=(4032&chunk)>>6,d=63&chunk,base64+=encodings[a]+encodings[b]+encodings[c]+encodings[d];return 1===byteRemainder?(chunk=bytes[mainLength],a=(252&chunk)>>2,b=(3&chunk)<<4,base64+=encodings[a]+encodings[b]+"=="):2===byteRemainder&&(chunk=bytes[mainLength]<<8|bytes[mainLength+1],a=(64512&chunk)>>10,b=(1008&chunk)>>4,c=(15&chunk)<<2,base64+=encodings[a]+encodings[b]+encodings[c]+"="),base64}function base64Encode(str){for(var c1,c2,c3,CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",out="",i=0,len=str.length;i<len;){if(c1=255&str.charCodeAt(i++),i===len){out+=CHARS.charAt(c1>>2),out+=CHARS.charAt((3&c1)<<4),out+="==";break}if(c2=str.charCodeAt(i++),i===len){out+=CHARS.charAt(c1>>2),out+=CHARS.charAt((3&c1)<<4|(240&c2)>>4),out+=CHARS.charAt((15&c2)<<2),out+="=";break}c3=str.charCodeAt(i++),out+=CHARS.charAt(c1>>2),out+=CHARS.charAt((3&c1)<<4|(240&c2)>>4),out+=CHARS.charAt((15&c2)<<2|(192&c3)>>6),out+=CHARS.charAt(63&c3)}return out}function queryStringParam(key,url){url||(url=location.search),key=key.replace(/[*+?^$.\[\]{}()|\\\/]/g,"\\$&");var match=url.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)","i"));return match&&match[1].replace(/\+/g," ")}function addQueryStringParam(url,key,newValue){var match=url.match(new RegExp("[?]","i"));return null===match||0===match.length?url+"?"+key+"="+newValue:url+"&"+key+"="+newValue}function setNewQueryStringParam(url,key,newValue){key=key.replace(/[*+?^$.\[\]{}()|\\\/]/g,"\\$&");var match=url.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)","i"));return match=match&&match[1].replace(/\+/g," "),null===match||0===match.length?addQueryStringParam(url,key,newValue):url.replace(match,newValue)}function AttachmentResults_OnOpenTreeAttachment(sender,openerSource){var workIdParameter="",viewerId=sender.getAttribute("data-viewerId");viewerId&&(viewerId.indexOf(";")>0&&(workIdParameter=viewerId.split(";")[0]),OpenAttachmentViewer(workIdParameter,openerSource,viewerId+"|"))}function RetrieveAttachmentViewerUrl(workid,source,attachments,winX,winY,auto,e5LegacyBase){return""!=source&&null!=source||(source=top.window.name),""!=auto&&null!=auto||(auto=!1),null!=attachments&&attachments.length>1500&&(attachments="javascript:OpenAttachmentViewer_SelectedAttachmentsForViewer"),e5LegacyBase+"_layouts/15/e5/WorkAttachmentViewer.aspx?id="+workid+"&source="+source+"&auto="+auto+"&attachments="+attachments}function OpenAttachmentViewer(workid,source,attachments,winX,winY,auto){if(window.top!=window.self&&void 0!==top.OpenAttachmentViewer)return top.OpenAttachmentViewer(workid,source,attachments,winX,winY,auto);""!=source&&null!=source||(source=top.window.name),""!=auto&&null!=auto||(auto=!1),null!=attachments&&attachments.length>1500&&(OpenAttachmentViewer_SelectedAttachmentsForViewer=attachments,attachments="javascript:OpenAttachmentViewer_SelectedAttachmentsForViewer");var popupURL=e5LegacyBase+"_layouts/15/e5/WorkAttachmentViewer.aspx?id="+workid+"&source="+source+"&auto="+auto+"&attachments="+attachments,popupName="AttachmentViewer"+source;null==winX&&(winX=0),null==winY&&(winY=0);var popupFeatures="top="+winY+",left="+winX+",width=10,height=10,directories=no,location=no,menubar=no,status=no,resizable=yes,titlebar=yes,toolbar=no";switch(source){case"FindWork":mwinFindWorkViewer=window.open(popupURL,workid.replace(/-/g,"_"),popupFeatures,!0),mwinFindWorkViewer.focus();break;case"LaunchWork":mwinLaunchViewer=window.open(popupURL,popupName,popupFeatures,!0),mwinLaunchViewer.focus();break;case"GetNext":mwinGetNextViewer=window.open(popupURL,popupName,popupFeatures,!0),mwinGetNextViewer.focus();break;case"FindDocuments":mwinDocumentsViewer=window.open(popupURL,popupName,popupFeatures,!0),mwinDocumentsViewer.focus();break;case"CloneWork":case"CloneWithOptions":mwinCloneWorkViewer=window.open(popupURL,workid.replace(/-/g,"_"),popupFeatures,!0),mwinCloneWorkViewer.focus();break;case"GetWork":mwinGetWorkViewer=window.open(popupURL,popupName,popupFeatures,!0),mwinGetWorkViewer.focus();break;case"MergeWork":mwinMergeWorkViewer=window.open(popupURL,popupName,popupFeatures,!0),mwinMergeWorkViewer.focus();break;case"ChildWork":mwinChildWorkViewer=window.open(popupURL,popupName,popupFeatures,!0),mwinChildWorkViewer.focus();default:mwinGetWorkViewer=window.open(popupURL,popupName,popupFeatures,!0),mwinGetWorkViewer.focus()}}!function(){angular.module("e5AnywhereServices",[]),angular.module("e5Anywhere",["e5AnywhereServices","kendo.directives","ngSanitize","ngToast","pascalprecht.translate","ngStorage","angularMoment","ngAnimate","ngMaterial","angularFileUpload"]).constant("e5Config",{})}(),String.format=function(){for(var s=arguments[0],i=0;i<arguments.length-1;i++){var reg=new RegExp("\\{"+i+"\\}","gm");s=s.replace(reg,arguments[i+1])}return s},String.prototype.endsWith=function(suffix){return this.substr(this.length-suffix.length)===suffix},String.prototype.startsWith=function(prefix){return this.substr(0,prefix.length)===prefix},function(){"use strict";function setup($){function install(el,opts){var css,themedCSS,full=el==window,msg=opts&&void 0!==opts.message?opts.message:void 0;if(opts=$.extend({},$.blockUI.defaults,opts||{}),!opts.ignoreIfBlocked||!$(el).data("blockUI.isBlocked")){if(opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{}),css=$.extend({},$.blockUI.defaults.css,opts.css||{}),opts.onOverlayClick&&(opts.overlayCSS.cursor="pointer"),themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{}),msg=void 0===msg?opts.message:msg,full&&pageBlock&&remove(window,{fadeOut:0}),msg&&"string"!=typeof msg&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg,data={};$(el).data("blockUI.history",data),data.el=node,data.parent=node.parentNode,data.display=node.style.display,data.position=node.style.position,data.parent&&data.parent.removeChild(node)}$(el).data("blockUI.onUnblock",opts.onUnblock);var lyr1,lyr2,lyr3,s,z=opts.baseZ;lyr1=$(msie||opts.forceIframe?'<iframe class="blockUI" style="z-index:'+z+++';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>':'<div class="blockUI" style="display:none"></div>'),lyr2=$(opts.theme?'<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+z+++';display:none"></div>':'<div class="blockUI blockOverlay" style="z-index:'+z+++';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>'),opts.theme&&full?(s='<div class="blockUI '+opts.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:fixed">',opts.title&&(s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||"&nbsp;")+"</div>"),s+='<div class="ui-widget-content ui-dialog-content"></div>',s+="</div>"):opts.theme?(s='<div class="blockUI '+opts.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:absolute">',opts.title&&(s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||"&nbsp;")+"</div>"),s+='<div class="ui-widget-content ui-dialog-content"></div>',s+="</div>"):s=full?'<div class="blockUI '+opts.blockMsgClass+' blockPage" style="z-index:'+(z+10)+';display:none;position:fixed"></div>':'<div class="blockUI '+opts.blockMsgClass+' blockElement" style="z-index:'+(z+10)+';display:none;position:absolute"></div>',lyr3=$(s),msg&&(opts.theme?(lyr3.css(themedCSS),lyr3.addClass("ui-widget-content")):lyr3.css(css)),opts.theme||lyr2.css(opts.overlayCSS),lyr2.css("position",full?"fixed":"absolute"),(msie||opts.forceIframe)&&lyr1.css("opacity",0);var layers=[lyr1,lyr2,lyr3],$par=$(full?"body":el);$.each(layers,function(){this.appendTo($par)}),opts.theme&&opts.draggable&&$.fn.draggable&&lyr3.draggable({handle:".ui-dialog-titlebar",cancel:"li"});var expr=setExpr&&(!$.support.boxModel||$("object,embed",full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.support.boxModel&&$("html,body").css("height","100%"),(ie6||!$.support.boxModel)&&!full)var t=sz(el,"borderTopWidth"),l=sz(el,"borderLeftWidth"),fixT=t?"(0 - "+t+")":0,fixL=l?"(0 - "+l+")":0;$.each(layers,function(i,o){var s=o[0].style;if(s.position="absolute",i<2)full?s.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+opts.quirksmodeOffsetHack+') + "px"'):s.setExpression("height",'this.parentNode.offsetHeight + "px"'),full?s.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):s.setExpression("width",'this.parentNode.offsetWidth + "px"'),fixL&&s.setExpression("left",fixL),fixT&&s.setExpression("top",fixT);else if(opts.centerY)full&&s.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),s.marginTop=0;else if(!opts.centerY&&full){var top=opts.css&&opts.css.top?parseInt(opts.css.top,10):0,expression="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+top+') + "px"';s.setExpression("top",expression)}})}if(msg&&(opts.theme?lyr3.find(".ui-widget-content").append(msg):lyr3.append(msg),(msg.jquery||msg.nodeType)&&$(msg).show()),(msie||opts.forceIframe)&&opts.showOverlay&&lyr1.show(),opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp,cb1=opts.showOverlay&&!msg?cb:noOp,cb2=msg?cb:noOp;opts.showOverlay&&lyr2._fadeIn(opts.fadeIn,cb1),msg&&lyr3._fadeIn(opts.fadeIn,cb2)}else opts.showOverlay&&lyr2.show(),msg&&lyr3.show(),opts.onBlock&&opts.onBlock.bind(lyr3)();if(bind(1,el,opts),full?(pageBlock=lyr3[0],pageBlockEls=$(opts.focusableElements,pageBlock),opts.focusInput&&setTimeout(focus,20)):center(lyr3[0],opts.centerX,opts.centerY),opts.timeout){var to=setTimeout(function(){full?$.unblockUI(opts):$(el).unblock(opts)},opts.timeout);$(el).data("blockUI.timeout",to)}}}function remove(el,opts){var count,full=el==window,$el=$(el),data=$el.data("blockUI.history"),to=$el.data("blockUI.timeout");to&&(clearTimeout(to),$el.removeData("blockUI.timeout")),opts=$.extend({},$.blockUI.defaults,opts||{}),bind(0,el,opts),null===opts.onUnblock&&(opts.onUnblock=$el.data("blockUI.onUnblock"),$el.removeData("blockUI.onUnblock"));var els;els=full?$("body").children().filter(".blockUI").add("body > .blockUI"):$el.find(">.blockUI"),opts.cursorReset&&(els.length>1&&(els[1].style.cursor=opts.cursorReset),els.length>2&&(els[2].style.cursor=opts.cursorReset)),full&&(pageBlock=pageBlockEls=null),opts.fadeOut?(count=els.length,els.stop().fadeOut(opts.fadeOut,function(){0==--count&&reset(els,data,opts,el)})):reset(els,data,opts,el)}function reset(els,data,opts,el){var $el=$(el);if(!$el.data("blockUI.isBlocked")){els.each(function(i,o){this.parentNode&&this.parentNode.removeChild(this)}),data&&data.el&&(data.el.style.display=data.display,data.el.style.position=data.position,data.el.style.cursor="default",data.parent&&data.parent.appendChild(data.el),$el.removeData("blockUI.history")),$el.data("blockUI.static")&&$el.css("position","static"),"function"==typeof opts.onUnblock&&opts.onUnblock(el,opts);var body=$(document.body),w=body.width(),cssW=body[0].style.width;body.width(w-1).width(w),body[0].style.width=cssW}}function bind(b,el,opts){var full=el==window,$el=$(el);if((b||(!full||pageBlock)&&(full||$el.data("blockUI.isBlocked")))&&($el.data("blockUI.isBlocked",b),full&&opts.bindEvents&&(!b||opts.showOverlay))){var events="mousedown mouseup keydown keypress keyup touchstart touchend touchmove";b?$(document).bind(events,opts,handler):$(document).unbind(events,handler)}}function handler(e){if("keydown"===e.type&&e.keyCode&&9==e.keyCode&&pageBlock&&e.data.constrainTabKey){var els=pageBlockEls,fwd=!e.shiftKey&&e.target===els[els.length-1],back=e.shiftKey&&e.target===els[0];if(fwd||back)return setTimeout(function(){focus(back)},10),!1}var opts=e.data,target=$(e.target);return target.hasClass("blockOverlay")&&opts.onOverlayClick&&opts.onOverlayClick(e),target.parents("div."+opts.blockMsgClass).length>0||0===target.parents().children().filter("div.blockUI").length}function focus(back){if(pageBlockEls){var e=pageBlockEls[!0===back?pageBlockEls.length-1:0];e&&e.focus()}}function center(el,x,y){var p=el.parentNode,s=el.style,l=(p.offsetWidth-el.offsetWidth)/2-sz(p,"borderLeftWidth"),t=(p.offsetHeight-el.offsetHeight)/2-sz(p,"borderTopWidth");x&&(s.left=l>0?l+"px":"0"),y&&(s.top=t>0?t+"px":"0")}function sz(el,p){return parseInt($.css(el,p),10)||0}$.fn._fadeIn=$.fn.fadeIn;var noOp=$.noop||function(){},msie=/MSIE/.test(navigator.userAgent),ie6=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent),setExpr=(document.documentMode,$.isFunction(document.createElement("div").style.setExpression));$.blockUI=function(opts){install(window,opts)},$.unblockUI=function(opts){remove(window,opts)},$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');title&&$m.append("<h1>"+title+"</h1>"),message&&$m.append("<h2>"+message+"</h2>"),void 0===timeout&&(timeout=3e3);var callBlock=function(opts){opts=opts||{},$.blockUI({message:$m,fadeIn:void 0!==opts.fadeIn?opts.fadeIn:700,fadeOut:void 0!==opts.fadeOut?opts.fadeOut:1e3,timeout:void 0!==opts.timeout?opts.timeout:timeout,centerY:!1,showOverlay:!1,onUnblock:onClose,css:$.blockUI.defaults.growlCSS})};callBlock();$m.css("opacity");$m.mouseover(function(){callBlock({fadeIn:0,timeout:3e4});var displayBlock=$(".blockMsg");displayBlock.stop(),displayBlock.fadeTo(300,1)}).mouseout(function(){$(".blockMsg").fadeOut(1e3)})},$.fn.block=function(opts){if(this[0]===window)return $.blockUI(opts),this;var fullOpts=$.extend({},$.blockUI.defaults,opts||{});return this.each(function(){var $el=$(this);fullOpts.ignoreIfBlocked&&$el.data("blockUI.isBlocked")||$el.unblock({fadeOut:0})}),this.each(function(){"static"==$.css(this,"position")&&(this.style.position="relative",$(this).data("blockUI.static",!0)),this.style.zoom=1,install(this,opts)})},$.fn.unblock=function(opts){return this[0]===window?($.unblockUI(opts),this):this.each(function(){remove(this,opts)})},$.blockUI.version=2.7,$.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:!0,theme:!1,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:!1,baseZ:1e3,centerX:!0,centerY:!0,allowBodyStretch:!0,bindEvents:!0,constrainTabKey:!0,fadeIn:200,fadeOut:400,timeout:0,showOverlay:!0,focusInput:!0,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:!1};var pageBlock=null,pageBlockEls=[]}"function"==typeof define&&define.amd&&define.amd.jQuery?define(["jquery"],setup):setup(jQuery)}(),function(){"use strict";function e5translate($translate){return{}}angular.module("e5Anywhere").config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"../translate/",suffix:".json"}).useMissingTranslationHandlerLog().useSanitizeValueStrategy("sanitize").preferredLanguage("en")}]).factory("e5translate",e5translate),e5translate.$inject=["$translate"]}(),function(){"use strict";function e5Endpoints($log,e5Config){e5Config.webApiBase||$log.error("e5Config.webApiBase is not defined... unable to access any e5 web services.");var prefix=e5Config.webApiBase||"http://e5Config.webApiBase.is.undefined/";prefix+=prefix.indexOf("/",prefix.length-1)>0?"":"/";var settingsPrefix=e5Config.webApiSettingsBase||"http://e5Config.webApiSettingsBase.is.undefined/";return settingsPrefix+=settingsPrefix.indexOf("/",settingsPrefix.length-1)>0?"":"/",{attachmentGetAttachmentRoute:prefix+"Attachment/{0}?attachmentId={1}&attachmentTypeId={2}",attachmentGetBinaryRoute:prefix+"Attachment/GetBinary/{0}",attachmentGetConvertTargetsRoute:prefix+"Attachment/GetConvertTargets/{0}",attachmentAddRoute:prefix+"Attachment/Add/{0}",attachmentAttachRoute:prefix+"Attachment/Attach/{0}/{1}",attachmentDetachRoute:prefix+"Attachment/Detach/{0}/{1}",attachmentConvertRoute:prefix+"Attachment/Convert/{0}/{1}/{2}",attachmentChangeTypeRoute:prefix+"Attachment/ChangeType/{0}/{1}/{2}",attachmentSplitRoute:prefix+"Attachment/Split/{0}/{1}",attachmentTearOffRoute:prefix+"Attachment/TearOff/{0}/{1}",attachmentEmailRoute:prefix+"Attachment/Email/{0}/{1}?attachmentId={2}",attachmenttypeGetAttachmentTypeRoute:prefix+"AttachmentType/{0}",casenoteAddRoute:prefix+"CaseNote/Add/{0}/{1}",casenoteGetCaseNoteRoute:prefix+"CaseNote/{0}?includeRelated={1}&ofTypeId={2}&page={3}&pageSize={4}&orderBy={5}",casenoteExportRoute:prefix+"CaseNote/Export/{0}",casenotetypeGetRoute:prefix+"CaseNoteType",categorisationGetCategory1Route:prefix+"Categorisation/GetCategory1?activeOnly={0}",categorisationGetCategory2Route:prefix+"Categorisation/GetCategory2/{0}?activeOnly={1}",categorisationGetCategory3Route:prefix+"Categorisation/GetCategory3/{0}?activeOnly={1}",conversationGetConversationRoute:prefix+"Conversation/{0}",conversationGetTotalEmailCountRoute:prefix+"Conversation/GetTotalEmailCount/{0}",conversationGetUniqueEmailAsMhtmlRoute:prefix+"Conversation/GetUniqueEmailAsMhtml/{0}/{1}",conversationSendEmailRoute:prefix+"Conversation/SendEmail/{0}",documentGetDocumentTemplatesRoute:prefix+"Document/GetDocumentTemplates/{0}?filter={1}",documentCreateRoute:prefix+"Document/Create/{0}/{1}/{2}?documentName={3}",fieldGetFieldRoute:prefix+"Field/{0}?taskId={1}&tabId={2}&fieldSetId={3}&fieldId={4}",fieldGetListItemsRoute:prefix+"Taxonomy/Field/GetListItems/{0}?parentListId={1}&parentListItemId={2}",fieldGetListFilteredItemsRoute:prefix+"Taxonomy/Field/GetListFilteredItems/{0}?filterText={1}&maxRecordsToSuggest={2}&parentListId={3}&parentListItemId={4}",findworkitemGetFindWorkItemRoute:prefix+"FindWorkItem/{0}?includeArchives={1}&includeSLA={2}&includeAttachmentCount={3}&includeNextDueTask={4}&customProcedure={5}&attachmentTypeFilter={6}&select={7}&orderBy={8}&siteGroupsFilter={9}&page={10}&pageSize={11}",instanceGetAllRoute:settingsPrefix+"Instance",instanceGetRoute:settingsPrefix+"Instance/{0}",menuitemGetMenuItemRoute:prefix+"MenuItem/GetMenuItem/{0}?taskId={1}&menuItemCode={2}",menuitemInvokeMenuItemRoute:prefix+"MenuItem/InvokeMenuItem/{0}/{1}?taskId={2}&menuItemCode={3}",sectionsGetSectionsRoute:settingsPrefix+"Configuration/Sections",sectionsGetSectionRoute:settingsPrefix+"Configuration/Sections/{0}",sectionsCreateRoute:settingsPrefix+"Configuration/Sections/Create",settingsGetSettingsRoute:settingsPrefix+"Configuration/Settings",settingsGetFilteredSettingsRoute:settingsPrefix+"Configuration/Settings/{0}/{1}/{2}",settingsGetSettingRoute:settingsPrefix+"Configuration/Settings/{0}",settingsCreateRoute:settingsPrefix+"Configuration/Settings/Create",settingsUpdateRoute:settingsPrefix+"Configuration/Settings/Update",taskGetTaskRoute:prefix+"Task/{0}?taskId={1}&lockWorkItem={2}",taskGetPrescribableRoute:prefix+"Task/GetPrescribable/{0}",taskPrescribeRoute:prefix+"Task/Prescribe/{0}/{1}",taskSaveRoute:prefix+"Task/Save/{0}/{1}",taskCompleteRoute:prefix+"Task/Complete/{0}/{1}",workitemGetWorkItemRoute:prefix+"WorkItem/{0}",workitemGetNextRoute:prefix+"WorkItem/GetNext",workitemLockRoute:prefix+"WorkItem/Lock/{0}",workitemUnlockRoute:prefix+"WorkItem/Unlock/{0}",workitemCreateRoute:prefix+"WorkItem/Create/{0}/{1}/{2}",workitemUpdateRoute:prefix+"WorkItem/Update/{0}",workitemInvokeActionRoute:prefix+"WorkItem/InvokeAction/{0}/{1}",workitemGetDiariseReasonsRoute:prefix+"WorkItem/GetDiariseReasons/{0}",workitemGetAssignableUsersRoute:prefix+"WorkItem/GetAssignableUsers/{0}",workitemGenerateHtmlRoute:prefix+"WorkItem/GenerateHtml/{0}/{1}",workitemAttachmentsRoute:prefix+"UIAttachments/{0}",integration_BySiteApiIntegrationYammerYammerMessagesPostWorkItemMessageByWorkIdPostRoute:prefix+"Integration/Yammer/YammerMessages/PostWorkItemMessage/{0}?message={1}&groups={2}&topics={3}&action={4}",propertyGetRoute:prefix+"Property/{0}/{1}?resolveLookup={2}"}}angular.module("e5AnywhereServices").factory("e5Endpoints",e5Endpoints),e5Endpoints.$inject=["$log","e5Config"]}(),function(){"use strict";function attachmentdata($http,$location,ngToast,util,endpoints){function _getAttachment(workId,attachmentId,attachmentTypeId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===attachmentId&&(attachmentId=""),void 0===attachmentTypeId&&(attachmentTypeId="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentGetAttachmentRoute,workId,attachmentId,attachmentTypeId));return $http.get(url,{withCredentials:!0})}function _getBinary(attachmentId){void 0===attachmentId&&(attachmentId="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentGetBinaryRoute,attachmentId));return $http.get(url,{withCredentials:!0})}function _getConvertTargets(attachmentId){void 0===attachmentId&&(attachmentId="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentGetConvertTargetsRoute,attachmentId));return $http.get(url,{withCredentials:!0})}function _add(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentAddRoute,workId));return $http.post(url,{},{withCredentials:!0})}function _attach(workId,attachmentId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===attachmentId&&(attachmentId="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentAttachRoute,workId,attachmentId));return $http.put(url,{},{withCredentials:!0})}function _detach(workId,attachmentId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===attachmentId&&(attachmentId="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentDetachRoute,workId,attachmentId));return $http.put(url,{},{withCredentials:!0})}function _convert(workId,attachmentId,targetFormat){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===attachmentId&&(attachmentId=""),void 0===targetFormat&&(targetFormat="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentConvertRoute,workId,attachmentId,targetFormat));return $http.put(url,{},{withCredentials:!0})}function _changeType(workId,attachmentId,targetAttachmentType){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===attachmentId&&(attachmentId=""),void 0===targetAttachmentType&&(targetAttachmentType="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentChangeTypeRoute,workId,attachmentId,targetAttachmentType));return $http.put(url,{},{withCredentials:!0})}function _split(workId,attachmentId,putdata){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===attachmentId&&(attachmentId="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentSplitRoute,workId,attachmentId));return $http.put(url,putdata||{},{withCredentials:!0})}function _tearOff(workId,attachmentId,putdata){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===attachmentId&&(attachmentId="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentTearOffRoute,workId,attachmentId));return $http.put(url,putdata||{},{withCredentials:!0})}function _email(workId,attachmentId,putdata){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===attachmentId&&(attachmentId="");var url=util.addCacheBusterParam(String.format(endpoints.attachmentEmailRoute,workId,attachmentId,attachmentId));return $http.put(url,putdata||{},{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getAttachment:_getAttachment,getBinary:_getBinary,getConvertTargets:_getConvertTargets,add:_add,attach:_attach,detach:_detach,convert:_convert,changeType:_changeType,split:_split,tearOff:_tearOff,email:_email});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("attachmentdata",attachmentdata),attachmentdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function attachmenttypedata($http,$location,ngToast,util,endpoints){function _getAttachmentType(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.attachmenttypeGetAttachmentTypeRoute,workId));return $http.get(url,{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getAttachmentType:_getAttachmentType});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("attachmenttypedata",attachmenttypedata),attachmenttypedata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function casenotedata($http,$location,ngToast,util,endpoints){function _add(workId,caseNoteField,postdata){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===caseNoteField&&(caseNoteField="");var url=util.addCacheBusterParam(String.format(endpoints.casenoteAddRoute,workId,caseNoteField));return $http.post(url,postdata||{},{withCredentials:!0})}function _getCaseNote(workId,includeRelated,ofTypeId,page,pageSize,orderBy,postdata){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===includeRelated&&(includeRelated=""),void 0===ofTypeId&&(ofTypeId=""),void 0===page&&(page=""),void 0===pageSize&&(pageSize=""),void 0===orderBy&&(orderBy="");var url=util.addCacheBusterParam(String.format(endpoints.casenoteGetCaseNoteRoute,workId,includeRelated,ofTypeId,page,pageSize,orderBy));return $http.post(url,postdata||{},{withCredentials:!0})}function _export(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.casenoteExportRoute,workId));return $http.get(url,{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{add:_add,getCaseNote:_getCaseNote,export:_export});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("casenotedata",casenotedata),casenotedata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function casenotetypedata($http,$location,ngToast,util,endpoints){function _get(){var url=util.addCacheBusterParam(String.format(endpoints.casenotetypeGetRoute));return $http.get(url,{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{get:_get});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("casenotetypedata",casenotetypedata),casenotetypedata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function categorisationdata($http,$location,ngToast,util,endpoints){function _getCategory1(activeOnly){void 0===activeOnly&&(activeOnly="");var url=util.addCacheBusterParam(String.format(endpoints.categorisationGetCategory1Route,activeOnly));return $http.get(url,{withCredentials:!0})}function _getCategory2(category1Id,activeOnly){void 0===category1Id&&(category1Id=""),void 0===activeOnly&&(activeOnly="");var url=util.addCacheBusterParam(String.format(endpoints.categorisationGetCategory2Route,category1Id,activeOnly));return $http.get(url,{withCredentials:!0})}function _getCategory3(category2Id,activeOnly){void 0===category2Id&&(category2Id=""),void 0===activeOnly&&(activeOnly="");var url=util.addCacheBusterParam(String.format(endpoints.categorisationGetCategory3Route,category2Id,activeOnly));return $http.get(url,{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getCategory1:_getCategory1,getCategory2:_getCategory2,getCategory3:_getCategory3});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("categorisationdata",categorisationdata),categorisationdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function conversationdata($http,$location,ngToast,util,endpoints){function _getConversation(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.conversationGetConversationRoute,workId));return $http.get(url,{withCredentials:!0})}function _getTotalEmailCount(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.conversationGetTotalEmailCountRoute,workId));return $http.get(url,{withCredentials:!0})}function _getUniqueEmailAsMhtml(workId,workAttachmentId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===workAttachmentId&&(workAttachmentId="");var url=util.addCacheBusterParam(String.format(endpoints.conversationGetUniqueEmailAsMhtmlRoute,workId,workAttachmentId));return $http.get(url,{withCredentials:!0})}function _sendEmail(workId,postdata){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.conversationSendEmailRoute,workId));return $http.post(url,postdata||{},{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getConversation:_getConversation,getTotalEmailCount:_getTotalEmailCount,getUniqueEmailAsMhtml:_getUniqueEmailAsMhtml,sendEmail:_sendEmail});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("conversationdata",conversationdata),conversationdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function documentdata($http,$location,ngToast,util,endpoints){function _getDocumentTemplates(workId,filter){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===filter&&(filter="");var url=util.addCacheBusterParam(String.format(endpoints.documentGetDocumentTemplatesRoute,workId,filter));return $http.get(url,{withCredentials:!0})}function _create(workId,templateId,attachmentTypeId,documentName){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===templateId&&(templateId=""),void 0===attachmentTypeId&&(attachmentTypeId=""),void 0===documentName&&(documentName="");var url=util.addCacheBusterParam(String.format(endpoints.documentCreateRoute,workId,templateId,attachmentTypeId,documentName));return $http.get(url,{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getDocumentTemplates:_getDocumentTemplates,create:_create});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("documentdata",documentdata),documentdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function fielddata($http,$location,ngToast,util,endpoints){function _getField(workId,taskId,tabId,fieldSetId,fieldId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===taskId&&(taskId=""),void 0===tabId&&(tabId=""),void 0===fieldSetId&&(fieldSetId=""),void 0===fieldId&&(fieldId="");var url=util.addCacheBusterParam(String.format(endpoints.fieldGetFieldRoute,workId,taskId,tabId,fieldSetId,fieldId));return $http.get(url,{
withCredentials:!0})}function _getListItems(listId,parentListId,parentListItemId){void 0===listId&&(listId=""),void 0===parentListId&&(parentListId=""),void 0===parentListItemId&&(parentListItemId="");var url=util.addCacheBusterParam(String.format(endpoints.fieldGetListItemsRoute,listId,parentListId,parentListItemId));return $http.get(url,{withCredentials:!0})}function _getListFilteredItems(listId,filterText,maxRecordsToSuggest,parentListId,parentListItemId){void 0===listId&&(listId=""),void 0===filterText&&(filterText=""),void 0===maxRecordsToSuggest&&(maxRecordsToSuggest=""),void 0===parentListId&&(parentListId=""),void 0===parentListItemId&&(parentListItemId="");var url=util.addCacheBusterParam(String.format(endpoints.fieldGetListFilteredItemsRoute,listId,filterText,maxRecordsToSuggest,parentListId,parentListItemId));return $http.get(url,{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getField:_getField,getListItems:_getListItems,getListFilteredItems:_getListFilteredItems});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("fielddata",fielddata),fielddata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function findworkitemdata($http,$location,ngToast,util,endpoints){function _getFindWorkItem(findClassId,includeArchives,includeSLA,includeAttachmentCount,includeNextDueTask,customProcedure,attachmentTypeFilter,select,orderBy,siteGroupsFilter,page,pageSize,postdata){void 0===findClassId&&(findClassId=""),void 0===includeArchives&&(includeArchives=""),void 0===includeSLA&&(includeSLA=""),void 0===includeAttachmentCount&&(includeAttachmentCount=""),void 0===includeNextDueTask&&(includeNextDueTask=""),void 0===customProcedure&&(customProcedure=""),void 0===attachmentTypeFilter&&(attachmentTypeFilter=""),void 0===select&&(select=""),void 0===orderBy&&(orderBy=""),void 0===siteGroupsFilter&&(siteGroupsFilter=""),void 0===page&&(page=""),void 0===pageSize&&(pageSize="");var url=util.addCacheBusterParam(String.format(endpoints.findworkitemGetFindWorkItemRoute,findClassId,includeArchives,includeSLA,includeAttachmentCount,includeNextDueTask,customProcedure,attachmentTypeFilter,select,orderBy,siteGroupsFilter,page,pageSize));return $http.post(url,postdata||{},{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getFindWorkItem:_getFindWorkItem});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("findworkitemdata",findworkitemdata),findworkitemdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function instancedata($http,$location,ngToast,util,endpoints){function _getAll(){var url=util.addCacheBusterParam(String.format(endpoints.instanceGetAllRoute));return $http.get(url,{withCredentials:!0})}function _get(id){void 0===id&&(id="");var url=util.addCacheBusterParam(String.format(endpoints.instanceGetRoute,id));return $http.get(url,{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getAll:_getAll,get:_get});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("instancedata",instancedata),instancedata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function menuitemdata($http,$location,ngToast,util,endpoints){function _getMenuItem(workId,taskId,menuItemCode){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===taskId&&(taskId=""),void 0===menuItemCode&&(menuItemCode="");var url=util.addCacheBusterParam(String.format(endpoints.menuitemGetMenuItemRoute,workId,taskId,menuItemCode));return $http.get(url,{withCredentials:!0})}function _invokeMenuItem(workId,menuItemId,taskId,menuItemCode,putdata){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===menuItemId&&(menuItemId=""),void 0===taskId&&(taskId=""),void 0===menuItemCode&&(menuItemCode="");var url=util.addCacheBusterParam(String.format(endpoints.menuitemInvokeMenuItemRoute,workId,menuItemId,taskId,menuItemCode));return $http.put(url,putdata||{},{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getMenuItem:_getMenuItem,invokeMenuItem:_invokeMenuItem});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("menuitemdata",menuitemdata),menuitemdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function propertydata($http,$location,ngToast,util,endpoints){function _get(workId,propertyId,resolveValue){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===propertyId&&(propertyId=""),void 0===resolveValue&&(resolveValue=!1);var url=util.addCacheBusterParam(String.format(endpoints.propertyGetRoute,workId,propertyId,resolveValue));return $http.get(url,{},{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{get:_get});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("propertydata",propertydata),propertydata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function sectionsdata($http,$location,ngToast,util,endpoints){function _getSections(){var url=util.addCacheBusterParam(String.format(endpoints.sectionsGetSectionsRoute));return $http.get(url,{withCredentials:!0})}function _getSection(id){void 0===id&&(id="");var url=util.addCacheBusterParam(String.format(endpoints.sectionsGetSectionRoute,id));return $http.get(url,{withCredentials:!0})}function _create(postdata){var url=util.addCacheBusterParam(String.format(endpoints.sectionsCreateRoute));return $http.post(url,postdata||{},{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getSections:_getSections,getSection:_getSection,create:_create});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("sectionsdata",sectionsdata),sectionsdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function settingsdata($http,$location,ngToast,util,endpoints){function _getSettings(){var url=util.addCacheBusterParam(String.format(endpoints.settingsGetSettingsRoute));return $http.get(url,{withCredentials:!0})}function _getFilteredSettings(application,section,key){void 0===application&&(application=""),void 0===section&&(section=""),void 0===key&&(key="");var url=util.addCacheBusterParam(String.format(endpoints.settingsGetFilteredSettingsRoute,application,section,key));return $http.get(url,{withCredentials:!0})}function _getSiteSettings(){var url=util.addCacheBusterParam(String.format(endpoints.settingsGetFilteredSettingsRoute,"e5Anywhere","SiteConfig",$location.host()));return $http.get(url,{withCredentials:!0})}function _getSetting(id){void 0===id&&(id="");var url=util.addCacheBusterParam(String.format(endpoints.settingsGetSettingRoute,id));return $http.get(url,{withCredentials:!0})}function _create(postdata){var url=util.addCacheBusterParam(String.format(endpoints.settingsCreateRoute));return $http.post(url,postdata||{},{withCredentials:!0})}function _update(putdata){var url=util.addCacheBusterParam(String.format(endpoints.settingsUpdateRoute));return $http.put(url,putdata||{},{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getSettings:_getSettings,getFilteredSettings:_getFilteredSettings,getSetting:_getSetting,create:_create,update:_update,getSiteSettings:_getSiteSettings});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("settingsdata",settingsdata),settingsdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function taskdata($http,$location,ngToast,util,endpoints){function _getTask(workId,taskId,lockWorkItem){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===taskId&&(taskId=""),void 0===lockWorkItem&&(lockWorkItem="");var url=util.addCacheBusterParam(String.format(endpoints.taskGetTaskRoute,workId,taskId,lockWorkItem));return $http.get(url,{withCredentials:!0})}function _getTasks(workId,lockWorkItem){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===lockWorkItem&&(lockWorkItem="");var url=util.addCacheBusterParam(String.format(endpoints.taskGetTaskRoute,workId,"",lockWorkItem));return $http.get(url,{withCredentials:!0})}function _getPrescribable(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.taskGetPrescribableRoute,workId));return $http.get(url,{withCredentials:!0})}function _prescribe(workId,prescribeTaskId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===prescribeTaskId&&(prescribeTaskId="");var url=util.addCacheBusterParam(String.format(endpoints.taskPrescribeRoute,workId,prescribeTaskId));return $http.put(url,{},{withCredentials:!0})}function _save(workId,taskId,putdata){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===taskId&&(taskId="");var url=util.addCacheBusterParam(String.format(endpoints.taskSaveRoute,workId,taskId));return $http.put(url,putdata||{},{withCredentials:!0})}function _complete(workId,taskId,putdata){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===taskId&&(taskId="");var url=util.addCacheBusterParam(String.format(endpoints.taskCompleteRoute,workId,taskId));return $http.put(url,putdata||{},{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getTask:_getTask,getPrescribable:_getPrescribable,prescribe:_prescribe,save:_save,complete:_complete,getTasks:_getTasks});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("taskdata",taskdata),taskdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function workitemdata($http,$location,ngToast,util,endpoints){function _getWorkItem(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.workitemGetWorkItemRoute,workId));return $http.get(url,{withCredentials:!0})}function _getNext(){var url=util.addCacheBusterParam(String.format(endpoints.workitemGetNextRoute));return $http.get(url,{withCredentials:!0})}function _lock(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.workitemLockRoute,workId));return $http.put(url,{},{withCredentials:!0})}function _unlock(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.workitemUnlockRoute,workId));return $http.put(url,{},{withCredentials:!0})}function _create(category1Id,category2Id,category3Id,postdata){void 0===category1Id&&(category1Id=""),void 0===category2Id&&(category2Id=""),void 0===category3Id&&(category3Id="");var url=util.addCacheBusterParam(String.format(endpoints.workitemCreateRoute,category1Id,category2Id,category3Id));return $http.post(url,postdata||{},{withCredentials:!0})}function _update(workId,putdata){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.workitemUpdateRoute,workId));return $http.put(url,putdata||{},{withCredentials:!0})}function _invokeAction(processAction,workId,putdata){var workId=util.resolveWorkId(workId);void 0===processAction&&(processAction=""),void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.workitemInvokeActionRoute,processAction,workId));return $http.put(url,putdata||{},{withCredentials:!0})}function _getDiariseReasons(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.workitemGetDiariseReasonsRoute,workId));return $http.get(url,{withCredentials:!0})}function _getAssignableUsers(workId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId="");var url=util.addCacheBusterParam(String.format(endpoints.workitemGetAssignableUsersRoute,workId));return $http.get(url,{withCredentials:!0})}function _generateHtml(workId,templateId){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===templateId&&(templateId="");var url=util.addCacheBusterParam(String.format(endpoints.workitemGenerateHtmlRoute,workId,templateId));return $http.get(url,{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{getWorkItem:_getWorkItem,getNext:_getNext,lock:_lock,unlock:_unlock,create:_create,update:_update,invokeAction:_invokeAction,getDiariseReasons:_getDiariseReasons,getAssignableUsers:_getAssignableUsers,generateHtml:_generateHtml});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("workitemdata",workitemdata),workitemdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function yammerdata($http,$location,ngToast,util,endpoints){function _add(workId,message,groups,topics,action){var workId=util.resolveWorkId(workId);void 0===workId&&(workId=""),void 0===message&&(message=""),void 0===groups&&(groups=""),void 0===topics&&(topics=""),void 0===action&&(action="");var url=util.addCacheBusterParam(String.format(endpoints.integration_BySiteApiIntegrationYammerYammerMessagesPostWorkItemMessageByWorkIdPostRoute,workId,message,groups,topics,action));return $http.post(url,{},{withCredentials:!0})}var service=(angular.injector(["ng"]).get("$q"),{addPost:_add});return $http.defaults.useXDomain=!0,service}angular.module("e5AnywhereServices").factory("yammerdata",yammerdata),yammerdata.$inject=["$http","$location","ngToast","e5UtilsService","e5Endpoints"]}(),function(){"use strict";function exceptionConfig($provide){$provide.decorator("$exceptionHandler",extendExceptionHandler)}function extendExceptionHandler($delegate,ngToast){return function(exception,cause){$delegate(exception,cause),exception.name&&-1!==exception.name.indexOf("QuotaExceededError")||"string"==typeof exception&&-1!==exception.indexOf("Possibly unhandled rejection")||ngToast.danger({content:exception})}}angular.module("e5Anywhere").config(exceptionConfig),exceptionConfig.$inject=["$provide"],extendExceptionHandler.$inject=["$delegate","ngToast"]}(),function(){function e5UtilsService($log,e5Config){function escape(string){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(string||"").replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function resolveWorkId(workId){if("function"==typeof queryStringParam){if(queryStringParam("_forceWorkId"))return worforceWorkIdkId}if(workId)return workId;if(e5Config.workId)return e5Config.workId;if("function"==typeof queryStringParam){var workIdParam=queryStringParam("workId");if(workIdParam)return workIdParam}return $log.warn("Unable to determine workId"),!1}function resolveTaskId(taskId){if("function"==typeof queryStringParam){if(queryStringParam("_forceTaskId"))return worforceTaskIdkId}if(taskId)return taskId;if(e5Config.taskId)return e5Config.taskId;if("function"==typeof queryStringParam){var taskIdParam=queryStringParam("taskId");if(taskIdParam)return taskIdParam}return $log.warn("Unable to determine taskId"),!1}function showWaiting(element,bShow,message){var jqProgress=$(element);"function"==typeof $(jqProgress).block?bShow?$(jqProgress).block({message:message,onBlock:function(layer){$(element.find(".blockOverlay")).click(function(){$(jqProgress).unblock()})}}):$(jqProgress).unblock():kendo.ui.progress(jqProgress,bShow)}function queryStringParam(key,url){url||(url=location.search),key=key.replace(/[*+?^$.\[\]{}()|\\\/]/g,"\\$&");var match=url.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)","i"));return match&&match[1].replace(/\+/g," ")}function addQueryStringParam(url,key,newValue){var match=url.match(new RegExp("[?]","i"));return null===match||0===match.length?url+"?"+key+"="+newValue:url+"&"+key+"="+newValue}function setNewQueryStringParam(url,key,newValue){key=key.replace(/[*+?^$.\[\]{}()|\\\/]/g,"\\$&");var match=url.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)","i"));return match=match&&match[1].replace(/\+/g," "),null===match||0===match.length?addQueryStringParam(url,key,newValue):url.replace(match,newValue)}function addCacheBusterParam(url){return url=setNewQueryStringParam(url,"cachebuster",Math.random())}return{escape:escape,resolveWorkId:resolveWorkId,resolveTaskId:resolveTaskId,showWaiting:showWaiting,addCacheBusterParam:addCacheBusterParam,setNewQueryStringParam:setNewQueryStringParam,addQueryStringParam:addQueryStringParam,queryStringParam:queryStringParam}}angular.module("e5AnywhereServices").service("e5UtilsService",e5UtilsService),e5UtilsService.$inject=["$log","e5Config"]}(),function(){function e5EnfoceService($log){function notUndefined(parameter,message){if(void 0===parameter)throw message||"parameter must be defined"}function notEmpty(parameter,message){if("string"!=typeof parameter||""===parameter)throw message||"parameter must not be empty"}function isPositive(parameter,message){if("number"!=typeof parameter||parameter<=0)throw message||"parameter must be a number greater than 0"}function isFunction(parameter,message){if("function"!=typeof parameter)throw message||"parameter must be a function"}return{notUndefined:notUndefined,notEmpty:notEmpty,isPositive:isPositive,isFunction:isFunction}}angular.module("e5AnywhereServices").service("e5Enforce",e5EnfoceService),e5EnfoceService.$inject=["$log"]}(),function(){"use strict";function e5EventhubService($rootScope,$log,e5Config,enforce){function listen(eventType,code,callback){enforce.notEmpty(eventType,"eventType must be defined in e5EventhubService.listen()"),enforce.notEmpty(code,"code must be defined in e5EventhubService.listen()"),enforce.isFunction(callback,"callback must be a function in e5EventhubService.listen()"),$rootScope.$on(EVENT_PREFIX_HANDLER+eventType+"-"+code,function(event,broadcastData){var ea=broadcastData.eventArgs;callback&&callback(ea.source,ea.type,ea.code,ea.eventData,broadcastData.hubData)&&event.preventDefault()})}function broadcast(source,type,code,eventData,eventCallback){enforce.notEmpty(code,"code must be defined in e5EventhubService.broadcast()"),enforce.notEmpty(type,"type must be defined in e5EventhubService.broadcast()"),$rootScope.$broadcast(EVENT_HUB,{source:source,type:type,code:code,eventData:eventData,eventCallback:eventCallback})}function menu(source,code,eventData,eventCallback){broadcast(source,MENU_TYPE,code,eventData,eventCallback)}var EVENT_PREFIX_HANDLER="e5-event-handler-",EVENT_HUB="e5-event-hub",MENU_TYPE="menu";return{listen:listen,broadcast:broadcast,menu:menu,EVENT_PREFIX_HANDLER:EVENT_PREFIX_HANDLER,EVENT_HUB:EVENT_HUB,SAVE:"save",CONFIRM:"confirm",DIARISE:"diarise",ASSIGN:"assign",WORD:"word",EMAIL:"email",EMAILATTACHMENTS:"emailattachments",ALL:"*",MENU_TYPE:MENU_TYPE}}angular.module("e5AnywhereServices").service("e5EventhubService",e5EventhubService),e5EventhubService.$inject=["$rootScope","$log","e5Config","e5Enforce"]}(),function(){"use strict";function e5EventhubComponent($scope,$rootScope,$log,e5Config,service){function myLog(data,event,code,source,type){vm.showLog&&vm.log.push({time:new Date,event:event,code:code,data:data,source:source,type:type})}function confirm($eventArgs,$dialogData){myLog("OK : eventArgs="+JSON.stringify($eventArgs)+" dialogData="+JSON.stringify($dialogData),"",$eventArgs.code);var code=$eventArgs.code;$eventArgs.eventCallback&&$eventArgs.eventCallback($eventArgs.source,$eventArgs.type,$eventArgs.code,$eventArgs.eventData,$dialogData)||($rootScope.$broadcast(service.EVENT_PREFIX_HANDLER+service.MENU_TYPE+"-"+code,{eventArgs:$eventArgs,hubData:$dialogData}),$rootScope.$broadcast(service.EVENT_PREFIX_HANDLER+service.MENU_TYPE+"-*",{eventArgs:$eventArgs,hubData:$dialogData}))}function executeEvent(eventType,eventCode,eventArgs){var eventData=eventArgs.eventData||{};if(vm.customHandler({$source:eventArgs.source,$type:eventType,$code:eventCode,$eventArgs:eventArgs,$confirm:confirm,$cancel:function(eventArgs){vm.onDlgCancel(eventArgs)}}))return void myLog("handled by custom-dialog","",eventCode,eventArgs.source,eventType);if(eventType===service.MENU_TYPE)switch(vm.dlgTitle=eventData.dialogTitle,eventCode){case service.CONFIRM:vm.dlgMessage=eventData.confirmMessage,vm.dlgConfirm.open(eventArgs);break;case service.SAVE:vm.dlgMessage=eventData.confirmMessage,vm.dlgSave.open(eventArgs);break;case service.DIARISE:vm.dlgDiarise.open(eventArgs);break;case service.ASSIGN:vm.dlgAssign.open(eventArgs);break;case service.WORD:vm.dlgWord.open(eventArgs);break;case service.EMAIL:vm.dlgEmail.open(eventArgs);break;case service.EMAILATTACHMENTS:vm.dlgEmail.open(eventArgs,!0);break;default:confirm(eventArgs,{})}else myLog("WARNING: no type handler","",eventCode,eventArgs.source,eventType)}var vm=this;vm.log=[],vm.dlgConfirm={},vm.dlgSave={},vm.dlgDiarise={},vm.dlgAssign={},vm.dlgWord={},vm.dlgEmail={},vm.onDlgConfirm=function($eventArgs,$dialogData){confirm($eventArgs,$dialogData)},vm.onDlgCancel=function($eventArgs){myLog("CANCEL : eventArgs="+JSON.stringify($eventArgs),"",$eventArgs.code)},$rootScope.$on(service.EVENT_HUB,function(event,eventArgs){if(void 0===eventArgs||"string"!=typeof eventArgs.code||""===eventArgs.code)return void $log.warn("e5Eventhub received event "+event+" without the required 'code' argument ");if("string"!=typeof eventArgs.type||""===eventArgs.type)return void $log.warn("e5Eventhub received event "+event+" without the required 'eventType' argument ");var eventCode=eventArgs.code,eventType=eventArgs.type||"";myLog(eventArgs.eventData,event.name,eventCode,eventType,eventArgs.source||""),"object"==typeof eventArgs.eventData&&eventArgs.eventData.confirmSelection?service.broadcast("eventhub",service.MENU_TYPE,service.CONFIRM,{},function(_source,_type,code,eventData,hubData){executeEvent(eventType,eventCode,eventArgs)}):executeEvent(eventType,eventCode,eventArgs)}),vm.onClear=function(){vm.log=[{time:new Date,data:"Log cleared"}]},myLog("Started")}angular.module("e5Anywhere").component("e5Eventhub",{transclude:!1,bindings:{showLog:"=showLog",customHandler:"&customHandler"},template:"<div ng-show='$ctrl.showLog'><button class='btn btn-xs btn-default' ng-click='$ctrl.onClear()'>Clear</button><table class='small table table-striped'><thead><tr><td width='170px'>Time</td><td>event</td><td>source</td><td>type</td><td>code</td><td>data</td></tr></thead><tbody><tr ng-repeat='l in $ctrl.log track by $index'><td>{{l.time}}</td><td>{{l.event}}</td><td>{{l.source}}</td><td>{{l.type}}</td><td>{{l.code}}</td><td>{{l.data}}</td></tr></tbody></table><e5-dialog-diarise control='$ctrl.dlgDiarise' message='$ctrl.dlgMessage' on-diarise='$ctrl.onDlgConfirm($eventArgs, $dialogData)' on-cancel='$ctrl.onDlgCancel($eventArgs)'></e5-dialog-diarise><e5-dialog-confirm control='$ctrl.dlgConfirm' title='$ctrl.dlgTitle' message='$ctrl.dlgMessage' on-yes='$ctrl.onDlgConfirm($eventArgs, $dialogData)' on-no='$ctrl.onDlgCancel($eventArgs)'></e5-dialog-confirm><e5-dialog-save control='$ctrl.dlgSave' title='$ctrl.dlgTitle' message='$ctrl.dlgMessage' on-yes='$ctrl.onDlgConfirm($eventArgs, $dialogData)' on-no='$ctrl.onDlgCancel($eventArgs)'></e5-dialog-save><e5-dialog-assign control='$ctrl.dlgAssign' title='$ctrl.dlgTitle' message='$ctrl.dlgMessage' on-assign='$ctrl.onDlgConfirm($eventArgs, $dialogData)' on-cancel='$ctrl.onDlgCancel($eventArgs)'></e5-dialog-assign><e5-dialog-word control='$ctrl.dlgWord' title='$ctrl.dlgTitle' message='$ctrl.dlgMessage' on-assign='$ctrl.onDlgConfirm($eventArgs, $dialogData)' on-cancel='$ctrl.onDlgCancel($eventArgs)'></e5-dialog-word><e5-dialog-email control='$ctrl.dlgEmail' title='$ctrl.dlgTitle' message='$ctrl.dlgMessage' on-sent='$ctrl.onDlgConfirm($eventArgs, $dialogData)' on-cancel='$ctrl.onDlgCancel($eventArgs)'></e5-dialog-email></div>",controller:e5EventhubComponent}),e5EventhubComponent.$inject=["$scope","$rootScope","$log","e5Config","e5EventhubService"]}(),function(){"use strict";function e5DialogConfirmComponent($scope){var vm=this;vm.$onInit=function(){vm.actions=[{text:"Yes",primary:!0,action:function(){vm.onYes({$eventArgs:vm.eventArgs})}},{text:"No",action:function(){vm.onNo({$eventArgs:vm.eventArgs})}}],vm.control={open:function(eventArgs){vm.eventArgs=eventArgs,$scope.dialog.open()},close:function(){$scope.dialog.close()}}}}angular.module("e5Anywhere").component("e5DialogConfirm",{transclude:!1,bindings:{control:"=control",title:"=title",message:"=message",onYes:"&onYes",onNo:"&onNo"},template:"<b>e5-dialog-confirm </b><div kendo-dialog='dialog' k-title=\"$ctrl.title||'Confirm'\" k-modal='true' k-visible='false' k-actions='$ctrl.actions' k-animation='false' k-width='300' k-closable='false'>{{$ctrl.message||'Are you sure?'}}</div>",controller:e5DialogConfirmComponent}),e5DialogConfirmComponent.$inject=["$scope"]}(),function(){"use strict";function e5DialogDiariseComponent($scope,$log,$translate,workitemdata){var vm=this;vm.$onInit=function(){vm.errorMessage=!1,vm.dlgTitle="Diarise",vm.eventArgs={},vm.actions=[{text:$translate.instant("Diarise"),primary:!0,action:function(e){var now=new Date,dd=vm.diariseDate,dt=vm.diariseTime||new Date(dd.getFullYear(),dd.getMonth(),dd.getDay(),0,0),diariseDateTime=new Date(dd.getFullYear(),dd.getMonth(),dd.getDate(),dt.getHours(),dt.getMinutes(),0);diariseDateTime.getTime()<now.getTime()?($scope.$apply(function(){vm.errorMessage=$translate.instant("Please select a date and time in the future.")}),"function"==typeof e.preventDefault&&e.preventDefault()):vm.onDiarise({$eventArgs:vm.eventArgs,$dialogData:{result:"ok",DiariseReason:vm.diariseReason,DiariseUntilDate:kendo.toString(diariseDateTime,"yyyy-MM-dd"),DiariseUntilHours:dt.getHours(),DiariseUntilMinutes:dt.getMinutes()}})}},{text:$translate.instant("Cancel"),action:function(){vm.onCancel({$eventArgs:vm.eventArgs})}}],vm.control={open:function(eventArgs){vm.eventArgs=eventArgs,vm.diariseDate=new Date,vm.diariseTime=vm.diariseDate,vm.minDate=new Date,vm.dlgTitle=$translate.instant(vm.title||"Diarise"),vm.dsDiariseReason=[],vm.errorMessage="";var workId=((eventArgs||{}).eventData||{}).workId||"00000000-0000-0000-0000-000000000000";$log.debug(String.format("getDiariseReasons({0})",workId)),workitemdata.getDiariseReasons(workId).then(function(response){vm.dsDiariseReason=response.data},function(response){$log.error("Unable to getDiariseReasons : "+JSON.stringify(response))}).finally(function(){}),vm.dialog.open()},close:function(){vm.dialog.close()}}}}angular.module("e5Anywhere").component("e5DialogDiarise",{transclude:!1,bindings:{control:"=control",title:"=title",onDiarise:"&onDiarise",onCancel:"&onCancel"},template:"<b>e5-dialog-diarise </b><div kendo-dialog='$ctrl.dialog' class='e5Dialog e5DialogDiarise' k-title='$ctrl.dlgTitle' k-modal='true' k-visible='false' k-actions='$ctrl.actions' k-animation='false' k-width='300' k-closable='false'><center><div class='e5DialogHeading'>{{'Diarise Reason' | translate}}</div><select class='e5DiariseReasonDropDown' kendo-drop-down-list k-data-text-field='\"reason\"' k-data-value-field='\"reason\"' k-data-source='$ctrl.dsDiariseReason' ng-model='$ctrl.diariseReason'></select><div class='e5DialogHeading'>{{'Diarise Until Date' | translate}}</div><kendo-calendar class='e5DiariseCalendar' ng-model='$ctrl.diariseDate' min='$ctrl.minDate'></kendo-calendar><input class='e5DiariseTimePicker' kendo-time-picker ng-model='$ctrl.sTime' k-ng-model='$ctrl.diariseTime'/><div class='e5DialogError' ng-show='$ctrl.errorMessage'>{{$ctrl.errorMessage}}</div></center></div>",controller:e5DialogDiariseComponent}),e5DialogDiariseComponent.$inject=["$scope","$log","$translate","workitemdata"]}(),function(){"use strict";function e5DialogSaveComponent($scope){var vm=this;vm.$onInit=function(){vm.actions=[{text:"Yes",primary:!0,action:function(){vm.onYes({$eventArgs:vm.eventArgs})}},{text:"No",action:function(){vm.onNo({$eventArgs:vm.eventArgs})}}],vm.control={open:function(eventArgs){vm.eventArgs=eventArgs,$scope.dialog.open()},close:function(){$scope.dialog.close()}}}}angular.module("e5Anywhere").component("e5DialogSave",{transclude:!1,bindings:{control:"=control",title:"=title",message:"=message",onYes:"&onYes",onNo:"&onNo"},template:"<b>e5-dialog-save </b><div kendo-dialog='dialog' k-title=\"$ctrl.title||'Save'\" k-modal='true' k-visible='false' k-actions='$ctrl.actions' k-animation='false' k-width='300' k-closable='false'>{{$ctrl.message||'Would you like to save the changes to the work item?'}}</div>",controller:e5DialogSaveComponent}),e5DialogSaveComponent.$inject=["$scope"]}(),function(){"use strict";function e5DialogAssignComponent($scope,$log,$translate,workitemdata){var vm=this;vm.$onInit=function(){vm.errorMessage=!1,vm.dlgTitle="Assign Work",vm.eventArgs={},vm.actions=[{text:$translate.instant("Assign"),primary:!0,action:function(e){var selLoginName=vm.selLoginName,selUser=!1;for(var i in vm.dsUsers){var user=vm.dsUsers[i];if(user.loginName===selLoginName){selUser=user;break}}selUser?vm.onAssign({$eventArgs:vm.eventArgs,$dialogData:{result:"ok",AssignedUser:selUser.loginName,AssignedUserName:selUser.name,AssignedUserEmail:selUser.email}}):vm.errorMessage=String.format("Unable to find login name '{0}' in user list.",selLoginName)}},{text:$translate.instant("Cancel"),action:function(){vm.onCancel({$eventArgs:vm.eventArgs})}}],vm.control={open:function(eventArgs){vm.eventArgs=eventArgs,vm.dlgTitle=$translate.instant(vm.title||"Assign Work"),vm.errorMessage=!1,vm.selLoginName="";var workId=((eventArgs||{}).eventData||{}).workId||"00000000-0000-0000-0000-000000000000";$log.debug(String.format("getAssignableUsers({0})",workId)),workitemdata.getAssignableUsers(workId).then(function(response){response.data.unshift({loginName:"",name:"(no one)",email:""}),vm.dsUsers=response.data,vm.ddlUsers.select(0)},function(response){$log.error("Unable to getAssignableUsers : "+JSON.stringify(response))}).finally(function(){}),vm.dialog.open()},close:function(){vm.dialog.close()}}}}angular.module("e5Anywhere").component("e5DialogAssign",{transclude:!1,bindings:{control:"=control",title:"=title",onAssign:"&onAssign",onCancel:"&onCancel"},template:"<b>e5-dialog-assign </b><div kendo-dialog='$ctrl.dialog' class='e5Dialog e5DialogAssign' k-title='$ctrl.dlgTitle' k-modal='true' k-visible='false' k-actions='$ctrl.actions' k-animation='false' k-width='300' k-closable='false'><center><div class='e5DialogHeading'>{{'Assign To' | translate}}</div><select class='e5DropDown e5UsersDropDown' kendo-drop-down-list='$ctrl.ddlUsers' k-data-text-field='\"name\"' k-data-value-field='\"loginName\"' k-data-source='$ctrl.dsUsers' ng-model='$ctrl.selLoginName'></select><div class='e5DialogError' ng-show='$ctrl.errorMessage'>{{$ctrl.errorMessage}}</div></center></div>",controller:e5DialogAssignComponent}),e5DialogAssignComponent.$inject=["$scope","$log","$translate","workitemdata"]}(),function(){"use strict";function e5DialogAssignComponent($scope,$log,$translate,$element,util,workitemdata,documentdata,attachmenttypedata,ngToast){var vm=this,$q=angular.injector(["ng"]).get("$q");vm.$onInit=function(){function onCreate(e){vm.selLoginName,$element.find(".e5DialogWord");if(!vm.disabled&&!vm.generating){$log.debug("Generating document from template "+vm.templateId+" type "+vm.attachmentTypeId);var promises=[documentdata.create(vm.workId,vm.templateId,vm.attachmentTypeId)];return util.showWaiting(vm.dialog.element,!0,$translate.instant("Generating Document")),$q.all(promises).then(function(response){var generateResponse=response[0];vm.onCreate({$eventArgs:vm.eventArgs,$dialogData:generateResponse.data}),ngToast.info({content:$translate.instant("Document created.")}),vm.dialog.close()},function(response){vm.errorMessage=$translate.instant("Unable to generate document. ")+" : "+JSON.stringify(response.data),$log.error(vm.errorMessage+" - "+JSON.stringify(response))
}).finally(function(){vm.generating=!1,$scope.$apply(),util.showWaiting(vm.dialog.element,!1)}),vm.generating=!0,!1}}function onCancel(e){vm.onCancel({$eventArgs:vm.eventArgs})}function open(eventArgs){vm.eventArgs=eventArgs,vm.dlgTitle=$translate.instant(vm.dlgTitle||"Create Word Document"),vm.errorMessage=!1,vm.dsTemplates=[],vm.dsAttachmentTypes=[],vm.loading=!0,vm.templateId=0,vm.attachmentTypeId=0,vm.workId="",vm.generating=!1;var eventData=(eventArgs||{}).eventData||{};if(!eventData.workId)return vm.errorMessage=$translate.instant("The e5 event hub data must contain a workId."),vm.loading=!1,void vm.dialog.open();vm.workId=eventData.workId||"00000000-0000-0000-0000-000000000000";var promises=[documentdata.getDocumentTemplates(vm.workId),attachmenttypedata.getAttachmentType(vm.workId)];$q.all(promises).then(function(response){var templateResponse=response[0];templateResponse.data&&templateResponse.data.length>0?(vm.dsTemplates=templateResponse.data,vm.templateId=templateResponse.data[0].id):vm.errorMessage=$translate.instant("There are no templates available.");var attchemtnTypeResponse=response[1];attchemtnTypeResponse.data&&attchemtnTypeResponse.data.length>0&&(vm.dsAttachmentTypes=attchemtnTypeResponse.data)},function(response){vm.errorMessage=$translate.instant("Unable to getDocumentTemplates and getAttachmentTypes")+" : "+JSON.stringify(response),$log.error(vm.errorMessage)}).finally(function(){vm.loading=!1,$scope.$apply()}),vm.dialog.open()}function close(){vm.dialog.close()}vm.errorMessage=!1,vm.dlgTitle="Create Word Document",vm.eventArgs={},vm.actions=[{text:$translate.instant("Create"),primary:!0,action:onCreate},{text:$translate.instant("Cancel"),action:onCancel}],vm.control={open:open,close:close}}}angular.module("e5Anywhere").component("e5DialogWord",{transclude:!1,bindings:{control:"=control",title:"=title",onCreate:"&onCreate",onCancel:"&onCancel"},controllerAs:"vm",template:"<b>e5-dialog-word </b><div kendo-dialog='vm.dialog' class='e5Dialog e5DialogWord' k-title='vm.dlgTitle' k-modal='true' k-visible='false' k-actions='vm.actions' k-animation='false' k-width='300' k-closable='false'><center><div class='e5DialogGroup'><div class='e5DialogHeading'>{{'Template' | translate}}</div><div class='k-block k-info-colored' ng-if='vm.loading'>{{'Loading...' | translate}}</div><div ng-if='!vm.loading'><select class='e5DropDown e5TemplateDropDown' ng-if='!vm.loading' kendo-drop-down-list='vm.ddlTemplates' k-data-text-field='\"name\"' k-data-value-field='\"id\"' k-data-source='vm.dsTemplates' k-value-primitive='true' k-ng-model='vm.templateId'></select></div></div><div class='e5DialogGroup'><div class='e5DialogHeading'>{{'Attachment Type' | translate}}</div><div class='k-block k-info-colored' ng-if='vm.loading'>{{'Loading...' | translate}}</div><div ng-if='!vm.loading'><select class='e5DropDown e5AttachmentTypeDropDown' kendo-drop-down-list='vm.ddlAttachmentTypes' k-data-text-field='\"name\"' k-data-value-field='\"id\"' k-data-source='vm.dsAttachmentTypes' k-value-primitive='true' k-ng-model='vm.attachmentTypeId'></select></div></div><div class='k-block k-error-colored'  ng-show='vm.errorMessage'><span class='e5Icon'>&#9888;&nbsp;</span>{{vm.errorMessage}}</div></center></div>",controller:e5DialogAssignComponent}),e5DialogAssignComponent.$inject=["$scope","$log","$translate","$element","e5UtilsService","workitemdata","documentdata","attachmenttypedata","ngToast"]}(),function(){"use strict";function e5DialogEmailComponent($scope,$log,$translate,ngToast){var vm=this;vm.$onInit=function(){vm.errorMessage=!1,vm.dlgTitle="Email",vm.eventArgs={},vm.dialog={},vm.ctlEmail={},vm.useInlineEditor=!0,vm.onSentCb=function($email){vm.dialog.close(),ngToast.success({content:$translate.instant("Email successfully sent")}),vm.onSent({$eventArgs:vm.eventArgs,$dialogData:$email})},vm.actions=[{text:"Send",primary:!0,action:function(){return vm.ctlEmail.send(),!1}},{text:"Cancel",action:function(){vm.onCancel({$eventArgs:vm.eventArgs})}}],vm.control={open:function(eventArgs,showAttachments){vm.eventArgs=eventArgs;var eventData=(eventArgs||{}).eventData||{};vm.workId=eventData.workId||"00000000-0000-0000-0000-000000000000",vm.from=eventData.from||"",vm.to=eventData.to||"",vm.cc=eventData.cc||"",vm.bcc=eventData.bcc||"",vm.subject=eventData.subject||"",vm.bodyHtml=eventData.bodyHtml||"",vm.showAttachments=!!showAttachments,vm.ctlEmail.activate(vm.workId,!0),vm.dialog.open()},close:function(){vm.dialog.close()}}}}angular.module("e5Anywhere").component("e5DialogEmail",{transclude:!1,bindings:{control:"=control",title:"=title",onSent:"&onSent",onCancel:"&onCancel"},controllerAs:"vm",template:"<b>e5-dialog-email </b><div kendo-dialog='vm.dialog' class='e5Dialog e5DialogEmail' k-title='vm.dlgTitle' k-modal='true' k-visible='false' k-actions='vm.actions' k-animation='false' k-closable='false'><e5-email control='vm.ctlEmail' work-id='vm.workId' use-inline-editor='true' hide-send='true' must-have-templates='true' from='vm.from' to='vm.to' cc='vm.cc' bcc='vm.bcc' subject='vm.subject' thread-id='vm.threadId' body-html='vm.bodyHtml' show-attachments='vm.showAttachments' show-templates='true' hide-cc='false' on-sent='vm.onSentCb($email)'></e5-email></div>",controller:e5DialogEmailComponent}),e5DialogEmailComponent.$inject=["$scope","$log","$translate","ngToast"]}(),function(){"use strict";function e5EmailController($scope,$log,$translate,$element,eventhub,util,workitemdata,attachmentdata,documentdata,conversationdata){function initilize(){var defaultEditorOptions={tools:[{name:"Send",template:"<button class='k-button send k-primary' ng-click='vm.onSend()'>{{'Send Email' | translate}}</button>"},"formatting","bold","italic","underline","strikethrough","subscript","superscript","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink"]};vm.ddlTemplates={},vm.txtEditor={},vm.onSend=send,vm.hideSend&&defaultEditorOptions.tools.splice(0,1),vm.editorOptions=defaultEditorOptions,activate(vm.workId)}function removeOriginalFromBody(){var body=vm.bodyHtml,iSep=body.indexOf(MARKER);return iSep>=0&&(body=body.substring(0,iSep)),body}function showSpinner(bShow,message){var jqProgress=$($element.find(".e5EmailForm"));"function"==typeof $(jqProgress).block?bShow?$(jqProgress).block({message:message,onBlock:function(layer){$($element.find(".blockOverlay")).click(function(){$(jqProgress).unblock()})}}):$(jqProgress).unblock():kendo.ui.progress(jqProgress,bShow)}function loadTemplate(templateId){vm.errorMessage="",showSpinner(!0,$translate.instant("Loading Template")),workitemdata.generateHtml(vm.workId,templateId).then(function(response){$log.debug(response),vm.lastTemplateId=templateId;var td=response.data;if(vm.to=vm.to||td.to,vm.subject&&(vm.subject.startsWith("RE:")||vm.subject.startsWith("FWD:"))||(vm.from=td.from,vm.cc=td.cc,vm.bcc=td.bcc),vm.isDirty=!1,vm.appendOriginal){var body=vm.bodyHtml,iSep=body.indexOf(MARKER);if(iSep>=0){var original=body.substring(iSep);vm.bodyHtml=td.bodyHtml+original}else vm.bodyHtml=td.bodyHtml+SEPERATOR+vm.originalHtml}else vm.bodyHtml=td.bodyHtml;null!=vm.subject&&""!=vm.subject&&(vm.subject.startsWith("RE:")||vm.subject.startsWith("FWD:"))||(vm.subject=td.subject)},function(response){vm.errorMessage="Unable to load template HTML.",$log.error(vm.errorMessage+" : "+JSON.stringify(response))}).finally(function(){showSpinner(!1)})}function activate(workId,selectFirstTemplate){$log.debug("activate() subject="+vm.subject);var CANNOTSENT_MESSAGE=$translate.instant("There are no Email templates available corresponding to this work item, so you cannot send any emails at this time.");if(vm.errorMessage="",vm.successMessage="",vm.dsTemplates=[],vm.dsAttachments=[],vm.loading=!0,vm.isDirty=!1,vm.lastTemplateId=0,vm.hideEmailSection=!1,vm.workId=workId||vm.workId,!vm.workId)return void(vm.loading=!1);vm.onSelect=function(e){vm.isDirty&&!confirm($translate.instant("The email body or subject has been modified and switching templates will lose your changes."))?(vm.templateId=vm.lastTemplateId,e.preventDefault()):loadTemplate(vm.templateId)},vm.onEditorChange=function(){vm.isDirty=!0},vm.onSubjectChange=function(){vm.isDirty=!0},$log.debug("Loading data");var promises=[attachmentdata.getAttachment(vm.workId),documentdata.getDocumentTemplates(vm.workId,".xslt")];$q.all(promises).then(function(response){$log.debug(response);var attachmentData=response[0],at=attachmentData.data;if(vm.dsAttachments=at&&at.length>0?at:[],vm.defaultAttachments&&"object"==typeof vm.defaultAttachments&&vm.defaultAttachments.length>0&&vm.dsAttachments.length>0)for(var iAttachment in vm.dsAttachments){var attachment=vm.dsAttachments[iAttachment];vm.defaultAttachments.indexOf(attachment.id)>=0&&(attachment.selected=!0)}var templateData=response[1],td=templateData.data;if(vm.dsTemplates=td&&td.length>0?td:[],vm.mustHaveTemplates&&0==vm.dsTemplates.length)vm.hideEmailSection=!0,vm.errorMessage=CANNOTSENT_MESSAGE;else if(vm.defaultTemplate&&"string"==typeof vm.defaultTemplate&&vm.dsTemplates&&vm.dsTemplates.length>0)for(var iTemplate in vm.dsTemplates){var template=vm.dsTemplates[iTemplate];if(template.name&&template.name.toLowerCase().endsWith(vm.defaultTemplate.toLowerCase())){$log.debug("Loading default template "+vm.defaultTemplate+"("+template.id+")"),vm.templateId=template.id,loadTemplate(template.id);break}}else selectFirstTemplate&&vm.dsTemplates.length>0&&(vm.templateId=vm.dsTemplates[0].id,loadTemplate(vm.templateId))},function(response){$scope.$apply(function(){vm.errorMessage="Unable to load external data.",$log.error(vm.errorMessage+" : "+JSON.stringify(response))})}).finally(function(){$scope.$apply(function(){vm.loading=!1})}),$scope.$watch("vm.appendOriginal",function(newValue,oldValue){newValue!=oldValue&&(vm.bodyHtml=newValue?removeOriginalFromBody()+SEPERATOR+vm.originalHtml:removeOriginalFromBody())}),$scope.$watch("vm.originalHtml",function(newValue){vm.appendOriginal&&(vm.bodyHtml=removeOriginalFromBody()+SEPERATOR+vm.originalHtml)}),$scope.$watch(function(){return vm.defaultAttachments},function(newValue){$log.debug("defaultAttachments changed: "+newValue);for(var iAttachment in vm.dsAttachments){var attachment=vm.dsAttachments[iAttachment];vm.defaultAttachments.indexOf(attachment.id)>=0?attachment.selected=!0:attachment.selected=!1}})}function sendFailed(response){vm.errorMessage="Unable to send email.",$log.error(vm.errorMessage+" : "+JSON.stringify(response))}function send(){vm.errorMessage="",vm.successMessage="",vm.hideEmailSection&&ngToast.success({content:CANNOTSENT_MESSAGE});var jqValidate=$($element.find(".e5EmailForm"));if($(jqValidate).kendoValidator({}).data("kendoValidator").validate())try{showSpinner(!0,$translate.instant("Sending Email"));var email={id:0,workId:vm.workId,threadId:vm.threadId,from:vm.from,to:vm.to,cc:vm.cc,bcc:vm.bcc,subject:vm.subject,bodyHtml:vm.bodyHtml,isFirst:!0,emailId:vm.emailId,messageType:vm.messageType||"normal",attachments:[]};angular.forEach(vm.dsAttachments,function(value,key){var copy;value.selected&&(copy=angular.copy(value),delete copy.selected,this.push(copy))},email.attachments),$log.debug(email),conversationdata.sendEmail(vm.workId,email).then(function(response){vm.onSent({$email:email}),vm.successMessage=$translate.instant("The email has been sent.")},function(response){showSpinner(!1),sendFailed(response)}).finally(function(){showSpinner(!1)})}catch(err){return sendFailed(err),void showSpinner(!1)}}var vm=this,$q=angular.injector(["ng"]).get("$q"),MARKER="\x3c!--#DoNotRemove--\x3e",SEPERATOR=MARKER;return vm.$onInit=function(){vm.control={initilize:initilize,activate:activate,send:send,loadTemplate:loadTemplate},initilize()},vm}angular.module("e5Anywhere").component("e5Email",{transclude:!0,bindings:{control:"=?control",workId:"=workId",from:"=?",to:"=?",cc:"=?",bcc:"=?",subject:"=?",bodyHtml:"=?",threadId:"=?",showAttachments:"=?",showTemplates:"=?",hideCc:"=?",onSent:"&",defaultTemplate:"=?",defaultAttachments:"=?",appendOriginal:"=?",originalHtml:"=?",hideSend:"=?",emailId:"=?",messageType:"=?",useInlineEditor:"=?",mustHaveTemplates:"=?"},controllerAs:"vm",template:"<div class='e5EmailForm'><div class='k-block k-error-colored' ng-show='vm.errorMessage'><span class='e5Icon'>&#9888;&nbsp;</span>{{vm.errorMessage}}</div><div class='k-block k-success-colored' ng-show='vm.successMessage'><span class='e5Icon'>&#10004;&nbsp;</span>{{vm.successMessage}}</div><div ng-show='!vm.hideEmailSection'><div class='details' ng-show='!vm.hideEmailSection'><div class='e5Heading'>{{'From' | translate}}</div><input class='k-textbox' type='text' ng-model='vm.from' disabled='disabled'></input><div class='e5Heading'>{{'To' | translate}}</div><input class='k-textbox' type='text' name='Email' ng-model='vm.to' required></input><div ng-hide='vm.hideCc'><div class='e5Heading'>{{'CC' | translate}}</div><input class='k-textbox' type='text' ng-model='vm.cc'></input><div class='e5Heading'>{{'BCC' | translate}}</div><input class='k-textbox' type='text' ng-model='vm.bcc'></input></div><div class='e5Heading'>{{'Subject' | translate}}</div><input class='k-textbox' type='text' ng-change='vm.onSubjectChange()' ng-model='vm.subject' required></input><div class='e5Templates' ng-show='vm.showTemplates'><div class='e5Heading' >{{'Template' | translate}}</div><div class='k-block k-info-colored' ng-hide='vm.dsTemplates.length || vm.loading'>{{'There are no templates available.' | translate}}</div><div class='k-block k-info-colored' ng-show='vm.loading'>{{'Loading...' | translate}}</div><div ng-show='vm.dsTemplates.length'><select kendo-drop-down-list='vm.ddlTemplates' k-data-text-field='\"name\"' k-data-value-field='\"id\"' k-data-source='vm.dsTemplates' k-value-primitive='true' k-ng-model='vm.templateId' on-change='vm.onSelect(kendoEvent)'></select></div></div><div class='e5Attachments' ng-show='vm.showAttachments'><div class='e5Heading'>{{'Attachments' | translate}} <span ng-show='vm.dsAttachments.length' class='e5Filter'><span class='k-icon k-i-filter'></span><input ng-model='vm.filterAttachment'/></span> </div><div class='k-block k-info-colored' ng-hide='vm.dsAttachments.length || vm.loading'>{{'There are no attachments available.' | translate}}</div><div class='k-block k-info-colored' ng-show='vm.loading'>{{'Loading...' | translate}}</div><div class='e5AttachmentList k-textbox' ng-show='vm.dsAttachments.length'><div class='item' ng-repeat='a in vm.dsAttachments  | filter: { documentName : vm.filterAttachment} track by $index'><input title='id {{a.id}}' type='checkbox' ng-model='a.selected' /><span>&nbsp;&#x1f4ce;</span> <span class='name'>{{a.documentName}}</span></div></div></div></div><div class='editor' ng-if='!vm.useInlineEditor'><textarea kendo-editor='vm.txtEditor' k-ng-model='vm.bodyHtml' k-options='vm.editorOptions' on-change='vm.onEditorChange()'></textarea></div><div class='editor' ng-if='vm.useInlineEditor'><div class='e5Heading'>{{'Body' | translate}}</div><div class='inline-editor' kendo-editor='vm.txtEditor' k-ng-model='vm.bodyHtml' k-options='vm.editorOptions' on-change='vm.onEditorChange()'></div></div></div></div>",controller:e5EmailController}),e5EmailController.$inject=["$scope","$log","$translate","$element","e5EventhubService","e5UtilsService","workitemdata","attachmentdata","documentdata","conversationdata"]}(),function(){function e5NotifictionService($log,$config){function _notifyWithInfo(type,message,moreInfo){alert(type+" : "+message+"\n"+JSON.stringify($config))}function notify(message,extra){$log.info(message+(extra?" "+extra:"")),_notifyWithInfo("notification",message,extra)}function info(message,extra){$log.info(message+(extra?" "+extra:"")),_notifyWithInfo("info",message,extra)}function success(message,extra){$log.info(message+(extra?" "+extra:"")),_notifyWithInfo("success",message,extra)}function warning(message,extra){$log.warn(message+(extra?" "+extra:"")),_notifyWithInfo("warning",message,extra)}function error(message,extra){$log.error(message+(extra?" "+extra:"")),_notifyWithInfo("error",message,extra)}return{notify:notify,info:info,success:success,warning:warning,error:error}}angular.module("e5AnywhereServices").service("e5NotifictionService",e5NotifictionService),e5NotifictionService.$inject=["$log","e5Config"]}(),function(){function e5SearchService($http,$log,findworkitemdata){return{searchWorkItems:function(options){return findworkitemdata.getFindWorkItem(options.findClassId,options.includeArchives,options.includeSLA,options.includeAttachmentCount,options.includeNextDueTask,options.customProcedure,options.attachmentTypeFilter,options.select,options.orderBy,options.siteGroupsFilter,options.page,options.pageSize||1,options.filterBy).then(function(response){var newResults=[];angular.forEach(response.data.results,function(rr,key){var aRow={};angular.forEach(response.data.columns,function(column,index){aRow[column.code]=rr[index]}),this.push(aRow)},newResults),response.data.results=newResults;var newColumns={};return angular.forEach(response.data.columns,function(rc,key){newColumns[rc.code]=rc}),response.data.columns=newColumns,response})}}}angular.module("e5AnywhereServices").service("e5SearchService",e5SearchService),e5SearchService.$inject=["$http","$log","findworkitemdata"]}(),function(){function e5SearchController($scope,$log,$service){var vm=this;vm.dataSource=null,$scope.$watch("$ctrl.options",function(newValue,oldValue){null==vm.dataSource&&(vm.dataSource=new kendo.data.DataSource({transport:{read:function(e){if(vm.cachedSuccess){var temp=vm.cachedSuccess;return vm.cachedSuccess=null,void e.success(temp)}var orderBy="";angular.forEach(e.data.sort,function(value,key){orderBy+=(""==orderBy?"":",")+("asc"==value.dir?"+":"-")+value.field});var selected=[];vm.options.select&&""!=vm.options.select.trim()&&angular.forEach(vm.options.select.split(","),function(value,key){var trimmed=value.trim();""!=trimmed&&selected.push(trimmed)});var options={findClassId:vm.options.findClassId||1,page:Math.max(e.data.page||1,1)-1,pageSize:Math.max(e.data.pageSize||1,1),includeArchives:vm.options.includeArchives||!1,includeAttachmentCount:vm.options.includeAttachmentCount||!1,includeSLA:vm.options.includeSLA||!1,includeNextDueTask:vm.options.includeNextDueTask||!1,customProcedure:"",select:vm.options.select,orderBy:orderBy.length>0?orderBy:vm.options.orderBy,filterBy:vm.options.filterBy};$service.searchWorkItems(options).then(function(response){var results=response.data,cachedColumnDefHead=[{headerTemplate:"<button class='k-button' ng-click='$ctrl.onRefresh()'><span class='reload-icon'/>Refresh</button>",template:"<button class='k-button' ng-click='$ctrl.onOpen($event)'>Open</button>",width:"100px"}],cachedColumnDef=[],cachedColumnDefMap={};if(angular.forEach(results.columns,function(value,key){var columnDef=null;"_AttachmentCount"==key?cachedColumnDefHead.push({field:key,title:"Attachments",width:"100px",template:"<button class='k-button' ng-click='$ctrl.onAttachment($event)'><span class='envelope-icon'/> #:data._AttachmentCount#</button>"}):"Id"==key||("_SLAExpiryStatus"==key?cachedColumnDefHead.push({field:key,title:"SLA",width:"50px",template:"<span class='sla-#:data._SLAExpiryStatus#-icon'/> "}):columnDef={field:key,title:value.label}),columnDef&&(cachedColumnDefMap[columnDef.field]=columnDef,this.push(columnDef))},cachedColumnDef),selected.length>0){var orderedCachedColumnDef=[];angular.forEach(selected,function(value){void 0!==cachedColumnDefMap[value]&&orderedCachedColumnDef.push(cachedColumnDefMap[value])}),cachedColumnDef=orderedCachedColumnDef}vm.cachedSuccess={data:results.results,total:results.total,errors:0},vm.gridOptions.columns=cachedColumnDefHead.concat(cachedColumnDef),e.success({data:["","",""],total:results.total,errors:0})},function(response){e.error("XHR response","500",response)})}},pageSize:vm.options.pageSize||10,serverPaging:!0,serverFiltering:!0,serverSorting:!0,schema:{data:"data",total:"total",errors:"errors",model:{id:"Id"}}}),vm.gridOptions={sortable:!0,pageable:!0,columns:[]}),angular.equals(newValue.select,oldValue.select)||vm.dataSource.read(),angular.equals(newValue,oldValue)||vm.dataSource.pageSize(newValue.pageSize)},!0),vm.onChange=function(data){vm.change({$data:data})},vm.onOpen=function($event){var sender=$event.currentTarget,row=angular.element(sender).closest("tr"),data=vm.kendoGrid.dataItem(row);vm.open({$data:data})},vm.onAttachment=function($event){var sender=$event.currentTarget,row=angular.element(sender).closest("tr"),data=vm.kendoGrid.dataItem(row);vm.attachment({$data:data})},vm.onRefresh=function(){vm.dataSource.read()}}angular.module("e5Anywhere").component("e5Search",{transclude:!1,bindings:{options:"=",open:"&onOpen",change:"&onChange",attachment:"&onAttachment",select:"&onSelect"},template:"<div class='e5-control e5-search' kendo-grid='$ctrl.kendoGrid' k-options='$ctrl.gridOptions' k-rebind='$ctrl.gridOptions' k-data-source='$ctrl.dataSource' k-selectable='true' k-on-change='$ctrl.onChange(data)'></div>",controller:e5SearchController}),e5SearchController.$inject=["$scope","$log","e5SearchService"]}(),function(){function e5WorkitemService($http,$log,notify,e5Config){function makeWebServiceCall(sMethod,sUrlSuffix,parameters,cbSuccess,cbError){try{var sUrl=(e5Config.webApiBase||"")+sUrlSuffix;sUrl+=(sUrlSuffix.indexOf("?")>0?"&ts=":"?ts=")+(new Date).getTime(),sDescription=sServiceName+"("+sUrl+") "+(parameters?" POST "+JSON.stringify(parameters):"");var httpRequest="POST"==sMethod||"PUT"==sMethod?{method:sMethod,url:sUrl,headers:{"Content-Type":"application/json"},data:parameters||null,withCredentials:!0}:{method:sMethod,url:sUrl,withCredentials:!0};$http(httpRequest).then(function(response){cbSuccess(response)},function(response){message="The "+sServiceName+" ("+JSON.stringify(httpRequest)+") failed.\n"+JSON.stringify(response),"function"==typeof cbError?cbError(response,message):notify(message)})}catch(ex){message="There was an error while trying to communicate with the "+sServiceName+" ("+JSON.stringify(httpRequest)+") web service on the remove server.\n"+sDescription+" Exception : "+ex.message+" "+ex.stack,"function"==typeof cbError?cbError(response,message):notify(message)}}function GetWorkItem(workId,success,error){if(!workId)return void error({},sServiceName+" requires a workId");makeWebServiceCall("GET","/WorkItem/"+workId,!1,success,error)}function GetNextWorkItem(success,error){makeWebServiceCall("GET","/WorkItem/GetNext",!1,success,error)}function LockWorkItem(workId,success,error){if(!workId)return void error({},sServiceName+" requires a workId");makeWebServiceCall("PUT","/WorkItem/Lock/"+workId,!1,success,error)}function UnlockWorkItem(workId,success,error){if(!workId)return void error({},sServiceName+" requires a workId");makeWebServiceCall("PUT","/WorkItem/Unlock/"+workId,!1,success,error)}function CreateWorkItem(category1,category2,category3,fieldValues,success,error){return category1?category2?category3?void makeWebServiceCall("POST","/WorkItem/Create/"+category1+"/"+category2+"/"+category3+"/",fieldValues,success,error):void error({},sServiceName+" requires a category3"):void error({},sServiceName+" requires a category2"):void error({},sServiceName+" requires a category1")}function UpdateWorkItem(workId,fieldValues,success,error){if(!workId)return void error({},sServiceName+" requires a workId");makeWebServiceCall("PUT","/WorkItem/Update/"+workId,fieldValues,success,error)}function AddCaseNote(workId,caseNoteField,caseNoteHtml,success,error){return workId?caseNoteField?caseNoteHtml?void makeWebServiceCall("POST","/CaseNote/Add/"+workId+"/"+caseNoteField,'"'+caseNoteHtml.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"',success,error):void error({},sServiceName+" requires a caseNoteHtml"):void error({},sServiceName+" requires a caseNoteField"):void error({},sServiceName+" requires a workId")}function GetCaseNoteTypes(success,error){makeWebServiceCall("GET","/CaseNoteType",null,success,error)}function GetCaseNotes(workId,includeRelated,ofTypeId,page,pageSize,orderBy,filterBy,success,error){if(!workId)return void error({},sServiceName+" requires a workId");var sUrl="/CaseNote/"+workId;sUrl+="?includeRelated="+(includeRelated?"1":"0"),sUrl+=ofTypeId?"&ofTypeId="+ofTypeId:"",sUrl+=page?"&page="+page:"",sUrl+=pageSize?"&pageSize="+pageSize:"",sUrl+=orderBy?"&orderBy="+orderBy:"",makeWebServiceCall("POST",sUrl,filterBy,success,error)}var sServiceName="e5WorkitemService";return{Get:GetWorkItem,GetNext:GetNextWorkItem,Lock:LockWorkItem,Unlock:UnlockWorkItem,Create:CreateWorkItem,Update:UpdateWorkItem,AddCaseNote:AddCaseNote,GetCaseNoteTypes:GetCaseNoteTypes,GetCaseNotes:GetCaseNotes}}angular.module("e5AnywhereServices").service("e5WorkitemService",e5WorkitemService),e5WorkitemService.$inject=["$http","$log","e5NotifictionService","e5Config"]}(),function(){function e5CaseNoteGridController($scope,$log,$sanitize,ngToast,casenotedata,casenotetypedata){function caseNoteTypeFilter(element){var dsCaseNoteTypes=new kendo.data.DataSource({transport:{read:function(e){casenotetypedata.get().then(function(response){e.success({data:response.data})},function(response){ngToast.danger({content:String.format("Could not get casenote types.")})})}},schema:{data:"data"}});element.kendoDropDownList({dataTextField:"name",dataValueField:"name",dataSource:dsCaseNoteTypes,optionLabel:"--Select Value--"})}var vm=this;vm.dataSource=null,vm.gridOptions={sortable:!0,pageable:{refresh:!0},filterable:{extra:!1,operators:{string:{eq:"Is equal to",startswith:"Starts with",contains:"Contains",endswith:"End with",neq:"Is not equal to",gt:"Is greater than",lt:"Is less than"}}},columns:[{field:"caseNoteDate",title:"Date",format:"{0:MM/dd/yyyy HH:mm tt}",width:200,filterable:{ui:"datetimepicker"}},{field:"caseNoteUser",width:150,title:"User"},{field:"caseNoteType",title:"Type",width:150,filterable:{ui:caseNoteTypeFilter}},{field:"caseNote",title:"Detail",encoded:!1}]},$scope.$watch("$ctrl.options",function(newValue,oldValue){vm.options=newValue,vm.dataSource=new kendo.data.DataSource({transport:{read:function(e){var page=Math.max(e.data.page||1,1)-1,pageSize=Math.max(e.data.pageSize||1,1),sortBy="";angular.forEach(e.data.sort,function(value,key){sortBy+=("desc"===value.dir?"-":"")+value.field+","});var filterBy=e.data.filter||{};casenotedata.getCaseNote(vm.options.workId,vm.options.includeRelated,vm.options.ofTypeId,page,pageSize,sortBy,filterBy).then(function(response){angular.forEach(response.data.results,function(value,key){value.caseNote=$sanitize(value.caseNote)}),e.success({data:response.data.results,total:response.data.total,errors:0})},function(response){ngToast.danger({content:String.format("Could not get casenote types.")})})}},pageSize:vm.options.pageSize||10,serverPaging:!0,serverFiltering:!0,serverSorting:!0,schema:{data:"data",total:"total",errors:"errors",model:{fields:{work_Id:{type:"string"},id:{type:"number"},caseNoteDate:{type:"date"},caseNoteUser:{type:"string"},caseNote:{type:"string"},propertyId:{type:"string"},category1_Id:{type:"number"},category2_Id:{type:"number"},category3_Id:{type:"number"},reference:{type:"number"}}}}})},!0)}angular.module("e5Anywhere").component("e5Casenotesgrid",{transclude:!1,bindings:{options:"="},template:"<div class='e5-control e5-casenotesgrid' kendo-grid='$ctrl.kendoGrid' k-options='$ctrl.gridOptions' k-data-source='$ctrl.dataSource' ></div>",controller:e5CaseNoteGridController}),e5CaseNoteGridController.$inject=["$scope","$log","$sanitize","ngToast","casenotedata","casenotetypedata"]}(),function(){function e5CaseNoteEditorController($scope,$log,$element,ngToast,$translate,casenotedata){var vm=this;vm.caseNoteHtml="",vm.onSave=function(){if(""==vm.caseNoteHtml)return void ngToast.info({content:$translate.instant("Case note must contain text.")});var jqProgress=$($element.find("div.progress"));kendo.ui.progress(jqProgress,!0),casenotedata.add(vm.options.workId,vm.options.caseNoteField,JSON.stringify(vm.caseNoteHtml)).then(function(response){vm.caseNoteHtml="",kendo.ui.progress(jqProgress,!1),vm.onSaved({$data:{workId:vm.options.workId,field:vm.options.caseNoteField,html:vm.caseNoteHtml}})},function(response){ngToast.danger({content:$translate.instant("Failed to add case note.")}),$log.error(JSON.stringify(response)),vm.onError({$error:response})}).finally(function(){kendo.ui.progress(jqProgress,!1)})},vm.editorOptions={tools:[{name:"save",template:"<button class='k-button' ng-click='$ctrl.onSave()'><span class='k-icon k-i-tick'></span>Save</button>"},"formatting","bold","italic","underline","strikethrough","subscript","superscript","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink"]}}angular.module("e5Anywhere").component("e5Casenoteseditor",{transclude:!1,bindings:{options:"=",onSaved:"&",onError:"&"},template:"<div class='e5CasenoteseditorComponent progress' style='position: relative;'><textarea kendo-editor k-ng-model='$ctrl.caseNoteHtml' k-options='$ctrl.editorOptions'></textarea></div>",controller:e5CaseNoteEditorController}),e5CaseNoteEditorController.$inject=["$scope","$log","$element","ngToast","$translate","casenotedata"]}(),function(){"use strict";function e5MenuController($scope,$rootScope,$http,$location,workitemdata,menuitemdata,ngToast,$translate,$element,$attrs,e5Config,e5EventhubService,util){function activate(){void 0!==$attrs.hidemenuitems&&$attrs.hidemenuitems.length>0&&($scope.hidemenuitems=$attrs.hidemenuitems.replace(/, /g,",").replace(/ ,/g,",").split(",")),$attrs.workId&&36===workId.length&&(workId=$attrs.workId),$attrs.taskId&&36===taskId.length&&(taskId=$attrs.taskId),$scope.e5LegacyBase=e5Config.e5LegacyBase,getMenuItems()}function onMenuSelect(menuItem){var menuItemCode=menuItem.code,eventData=angular.copy(menuItem);eventData.workId=util.resolveWorkId(workId),e5EventhubService.menu("e5MenuController",menuItemCode,eventData,function(source,type,code,eventData,hubData){toggleSpinner(1);var invokeMenuItemData={WorkItemChanges:{},TaskChanges:{},AdditionalProperties:hubData};menuitemdata.invokeMenuItem(workId,menuItem.id,taskId,"",invokeMenuItemData).then(function(response){getMenuItems()},function(response){if(-1!==response.data.indexOf("Parameter name: assemblyString"))return void getMenuItems();ngToast.danger({content:String.format("Failed to invoke menu item '{0}'",menuItem.code)})}).finally(function(){toggleSpinner(-1)})})}function getMenuItems(){workId&&36===workId.length&&(toggleSpinner(1),menuitemdata.getMenuItem(workId,taskId).then(function(response){$scope.menuItems=response.data},function(response){$scope.$apply(function(){$scope.menuItems=[]})}).finally(function(){toggleSpinner(-1)}))}function toggleSpinner(counterIncrementDecrement){if(void 0===spinCounter&&(spinCounter=0),spinCounter+=counterIncrementDecrement,1===counterIncrementDecrement&&1===spinCounter){if(!$scope.e5MenuForm||!$scope.e5MenuForm.$$element[0]||!$scope.e5MenuForm.$$element[0].id)return;kendo.ui.progress($("#"+$scope.e5MenuForm.$$element[0].id),!0)}if(-1===counterIncrementDecrement&&0===spinCounter){if(!$scope.e5MenuForm||!$scope.e5MenuForm.$$element[0]||!$scope.e5MenuForm.$$element[0].id)return;kendo.ui.progress($("#"+$scope.e5MenuForm.$$element[0].id),!1)}}var vm=this,workId="",taskId="",menuType="WORK";return void 0!==$attrs.taskId&&(menuType="TASK"),vm.$onInit=function(){var service={activate:activate,getMenuItems:getMenuItems};return $scope.$watch("$ctrl.workId",function(newId,oldId){!newId||36!==newId.length||newId===oldId&&""!==workId||(workId=newId,taskId||"WORK"!==menuType.toUpperCase()||getMenuItems())}),$scope.$watch("$ctrl.taskId",function(newId,oldId){!newId||36!==newId.length||newId===oldId&&""!==taskId||(taskId=newId,getMenuItems())}),$scope.onMenuSelect=onMenuSelect,$scope.menuItems=[],$scope.hidemenuitems=[],$scope.e5LegacyBase="",activate(),service},vm;var spinCounter}angular.module("e5Anywhere").component("e5Menu",{transclude:!0,bindings:{hidemenuitems:"@",showImages:"=",workId:"=workId",taskId:"=taskId"},
template:"<div id='e5MenuForm'><div class='buttons-wrap' ng-repeat='menuItem in menuItems'><kendo-button ng-style=\"$last && {'margin-right':'20px'}\" ng-class=\"{'showButtonImages': $ctrl.showImages }\" ng-if='menuItem.enabled && hidemenuitems.indexOf(menuItem.code)==-1' class='k-primary' style='float: left; margin: 0 2px 2px 2px;' ng-click='onMenuSelect(menuItem)' title='{{menuItem.label}}'><img ng-if='$ctrl.showImages' src='{{e5LegacyBase}}{{menuItem.imageUrlLarge}}'/><div class='buttonText'>{{menuItem.label}}</div></kendo-button></div></div>",controller:e5MenuController}),e5MenuController.$inject=["$scope","$rootScope","$http","$location","workitemdata","menuitemdata","ngToast","$translate","$element","$attrs","e5Config","e5EventhubService","e5UtilsService"]}(),function(){function e5AttachmentGridController($scope,$log,$element,$http,e5Config,ngToast,util,endpoints,attachmentdata,workitemdata,FileUploader){var vm=this;vm.onOpen=function(attachment){var url=e5Config.e5LegacyBase+"_layouts/e5/WorkAttachmentViewer.aspx?id="+attachment.WorkItemId+"&source=FindWork&auto=false&attachments="+attachment.WorkItemId+";"+attachment.DocId+"|";window.open(url,"E5AttachmentViewer","top=0,left=0,width=10,height=10,directories=no,location=no,menubar=no,status=no,resizable=yes,titlebar=yes,toolbar=no")},vm.getDocType=function(attachment){return attachment.DocTypeName||""},vm.$onInit=function(){vm.uploader=new FileUploader({url:util.addCacheBusterParam(String.format(endpoints.attachmentAddRoute,vm.workId)),withCredentials:!0,removeAfterUpload:!0}),vm.uploader.onCompleteItem=function(fileItem,response,status,headers){$log.info("onCompleteItem",fileItem,response,status,headers),vm.gridDataSource.read()},vm.uploader.onErrorItem=function(item,response,status,headers){$log.error("Failed to upload "+item.file.name+" "+response),ngToast.danger("Failed to upload "+item.file.name)},vm.grid={},vm.gridOptions={sortable:!0,resizable:!0,pageable:{refresh:!0},columns:[{field:"",title:"",width:35,template:"<i class='fa fa-paperclip' aria-hidden='true' ng-click='vm.onOpen(dataItem)' style='font-size:140%'></i>",attributes:{class:"fixedColumnWidth"}},{title:"",width:45,template:"<i class='fa fa-bars e5-attach' aria-hidden='true' style='font-size:140%'> </i>"},{field:"DocName",title:"Name"},{field:"DocTypeId",title:"Type",width:150,template:"{{vm.getDocType(dataItem)}}",minScreenWidth:570}]},$scope.$watch("vm.workId",function(newValue,oldValue){vm.gridDataSource=new kendo.data.DataSource({pageSize:vm.pageSize||5,transport:{read:function(e){if(void 0===vm.workId||""==vm.workId)e.success({data:[],total:0});else{var url=util.addCacheBusterParam(String.format(endpoints.workitemAttachmentsRoute,vm.workId));vm.url=url,$http.get(url,{withCredentials:!0}).then(function(response){$log.info(response);var results=response.data.value||[];e.success({data:results,total:results.length})},function(response){ngToast.danger({content:String.format("Could not get attachment data.")}),e.success({data:[],total:0})})}}},schema:{data:"data",total:"total"}}),vm.uploader.url=util.addCacheBusterParam(String.format(endpoints.attachmentAddRoute,vm.workId))}),$scope.$watch(angular.bind(workitemdata,function(){return this.workId}),function(newVal,oldVal){void 0!==newVal&&""!==newVal&&newVal!==oldVal&&(vm.workId=newVal)},!0)}}angular.module("e5Anywhere").component("e5AttachmentGrid",{bindings:{dtSourceType:"@",workId:"=",debugMode:"=",pageSize:"="},controllerAs:"vm",template:'<div class="wide e5attachmentsGrid"><div nv-file-drop="" uploader="vm.uploader"><div nv-file-over="" uploader="vm.uploader" class="drop-zone" over-class="file-over" style="height:100%" ><div class="upload-panel"><input name="file-input" id="file-input" class="file-input" type="file" nv-file-select="" uploader="vm.uploader" multiple /><label for="file-input" class="upload-button k-state-selected"><i class="fa fa-upload" alt="Remove Item" aria-hidden="true"></i>&nbsp;Attach files</label><div class="file-upload-list"><div class="upload-item" ng-repeat="item in vm.uploader.queue"><i class="fa fa-trash" alt="Remove Item" aria-hidden="true" ng-click="item.remove()" style="font-size:140%"></i>&nbsp;<span class="name">{{ item.file.name }}</span>&nbsp;<span>({{ item.file.size/1024/1024|number:2 }} Mb)</span></div></div><div ng-show="vm.uploader.queue.length > 0"><button type="button" class="btn btn-warning btn-xs" ng-click="vm.uploader.clearQueue()" ng-disabled="!vm.uploader.queue.length"><span class="glyphicon glyphicon-trash"></span> Remove all</button>&nbsp;<button type="button" class="btn btn-success btn-xs" ng-click="vm.uploader.uploadAll()" ng-disabled="!vm.uploader.getNotUploadedItems().length"><span class="glyphicon glyphicon-upload"></span> Upload all</button></div></div><div kendo-grid="vm.grid" k-options="vm.gridOptions" k-data-source="vm.gridDataSource"> </div><iframe class="download" width="0" height="0" frameborder="0" src=""></iframe></div></div></div>',controller:e5AttachmentGridController}),e5AttachmentGridController.$inject=["$scope","$log","$element","$http","e5Config","ngToast","e5UtilsService","e5Endpoints","attachmentdata","workitemdata","FileUploader"]}(),function(){"use strict";function e5ClassificationController($scope,$log,$rootScope,$http,$location,taskdata,workitemdata,ngToast,$translate,$element,$attrs,e5Endpoints,utils){function activate(){$scope.classification||($scope.classification=$scope.$parent.classification),$scope.classification||($scope.classification=$scope.$parent.$parent.classification),populateListData(String.format(e5Endpoints.categorisationGetCategory1Route,activeOnly)),populateListData(String.format(e5Endpoints.categorisationGetCategory2Route,$scope.classification.category1Id,activeOnly)),populateListData(String.format(e5Endpoints.categorisationGetCategory3Route,$scope.classification.category2Id,activeOnly))}function cat1Changed(kendoEvent){if(void 0!==kendoEvent&&null!==kendoEvent&&void 0!==kendoEvent.sender&&void 0!==kendoEvent.sender.selectedIndex){var apiUrl=String.format(e5Endpoints.categorisationGetCategory2Route,kendoEvent.sender.value(),activeOnly);$scope.cat2data=[],$scope.cat3data=[],$scope.classification.category2Id=null,$scope.classification.category3Id=null,populateListData(apiUrl)}}function cat2Changed(kendoEvent){if(void 0!==kendoEvent&&null!==kendoEvent&&void 0!==kendoEvent.sender&&void 0!==kendoEvent.sender.selectedIndex){var apiUrl=String.format(e5Endpoints.categorisationGetCategory3Route,kendoEvent.sender.value(),activeOnly);$scope.cat3data=[],$scope.classification.category3Id=null,populateListData(apiUrl)}}function populateListData(url){var url2=utils.addCacheBusterParam(url);$http.get(url2,{withCredentials:!0}).then(function(response){-1!==url.indexOf("GetCategory1")&&($scope.cat1data=response.data,$scope.categoryLoadedCount++),-1!==url.indexOf("GetCategory2")&&($scope.cat2data=response.data,$scope.categoryLoadedCount++),-1!==url.indexOf("GetCategory3")&&($scope.cat3data=response.data,$scope.categoryLoadedCount++)})}var activeOnly=!1,service={populateListData:populateListData,activate:activate};return $scope.Cat1Changed=cat1Changed,$scope.Cat2Changed=cat2Changed,$scope.classification||($scope.classification=$scope.$parent.classification),$scope.classification||($scope.classification=$scope.$parent.$parent.classification),$scope.categoryLoadedCount=0,activate(),service}angular.module("e5Anywhere").component("e5Classification",{transclude:!0,bindings:{classification:"="},template:"<div class='Classification' ng-if='categoryLoadedCount>=3'>\x3c!--<h4>Classification: {{classification.category1Id}}|{{classification.category2Id}}|{{classification.category3Id}}</h4>--\x3e<input k-on-change='Cat1Changed(kendoEvent)' kendo-drop-down-list id='cat1' ng-model='classification.category1Id' k-value-primitive='true' k-data-text-field=\"'name'\" k-data-value-field=\"'categoryId'\" k-data-source='cat1data' />&nbsp;<input k-on-change='Cat2Changed(kendoEvent)' kendo-drop-down-list id='cat2' ng-model='classification.category2Id' k-value-primitive='true' k-data-text-field=\"'name'\" k-data-value-field=\"'categoryId'\" k-data-source='cat2data' />&nbsp;<input kendo-drop-down-list id='cat3' ng-model='classification.category3Id' k-value-primitive='true' k-data-text-field=\"'name'\" k-data-value-field=\"'categoryId'\" k-data-source='cat3data' /></div>",controller:e5ClassificationController}),e5ClassificationController.$inject=["$scope","$log","$rootScope","$http","$location","taskdata","workitemdata","ngToast","$translate","$element","$attrs","e5Endpoints","e5UtilsService"]}(),function(){function e5FieldController($scope,$rootScope,$http,fielddata,workitemdata,ngToast,$translate,endpoints,util,e5EventhubService){function activate(){$scope.workId=vm.workId,$scope.taskId=vm.taskId,vm.fieldIn?($scope.field=vm.fieldIn,checkDefaults(),populateList()):getField(vm.workId,vm.taskId,vm.fieldId)}function onChange(field){var fieldkey=field.workFieldId,eventData={workId:$scope.workId,taskId:$scope.taskId,field:field};e5EventhubService.broadcast("field","onChange",fieldkey,eventData,null)}function getField(workId,taskId,fieldId){workId&&fieldId&&(toggleSpinner(1),fielddata.getField(workId,taskId,void 0,void 0,fieldId).then(function(fieldResponse){var data=fieldResponse.data;fieldId.length>0&&($scope.field=data[0],checkDefaults(),populateList())},function(response){ngToast.danger({content:$translate.instant("Failed to get field values")})}).finally(function(){toggleSpinner(-1)}))}function checkDefaults(){$scope.field&&""===$scope.field.resolvedValue&&null===$scope.field.value&&null!==$scope.field.defaultValue&&($scope.field.resolvedValue=$scope.field.defaultValue)}function populateList(){if($scope.field){var field=$scope.field;7===field.fieldDataType&&("Category1_Id"===field.workFieldId?getList(String.format(endpoints.categorisationGetCategory1Route,!0)+"&fieldId="+field.workFieldId,field.value):"Category2_Id"===field.workFieldId?getList(String.format(endpoints.categorisationGetCategory2Route,$rootScope.category1Id,!0)+"&fieldId="+field.workFieldId,field.value):"Category3_Id"===field.workFieldId?getList(String.format(endpoints.categorisationGetCategory3Route,$rootScope.category2Id,!0)+"&fieldId="+field.workFieldId,field.value):getList(String.format(endpoints.fieldGetListItemsRoute,field.listId,"","")+"&fieldId="+field.workFieldId,field.value))}}function getList(listRoute,selectedItemValue){toggleSpinner(1),$http.get(util.addCacheBusterParam(listRoute),{withCredentials:!0}).then(function(response){function adjustDropDownWidth(e){var listContainer=e.sender.list.closest(".k-list-container");listContainer.width(listContainer.width()+50)}var listData,url=response.config.url,fieldId=queryStringParam("fieldId",url),valueField="id";-1!==url.indexOf("GetCategory1")?(listData=response.data,fieldId="Category1_Id",valueField="categoryId"):-1!==url.indexOf("GetCategory2")?(listData=response.data,fieldId="Category2_Id",valueField="categoryId"):-1!==url.indexOf("GetCategory3")?(listData=response.data,fieldId="Category3_Id",valueField="categoryId"):listData=response.data.items;$("#"+fieldId).kendoDropDownList({optionLabel:" ",filter:"contains",dataSource:listData,dataTextField:"name",dataValueField:valueField,value:selectedItemValue,dataBound:adjustDropDownWidth})}).finally(function(){toggleSpinner(-1)})}function toggleSpinner(counterIncrementDecrement){if(void 0===spinCounter&&(spinCounter=0),spinCounter+=counterIncrementDecrement,1===counterIncrementDecrement&&1===spinCounter){if(!$("[ng-controller]"))return;kendo.ui.progress($("[ng-controller]"),!0)}if(-1===counterIncrementDecrement&&0===spinCounter){if(!$("[ng-controller]"))return;kendo.ui.progress($("[ng-controller]"),!1)}}var vm=this;vm.$onInit=function(){var service={activate:activate,getField:getField,getList:getList,populateList:populateList,toggleSpinner:toggleSpinner,spinCounter:spinCounter};return $scope.onChange=onChange,activate(),$scope.$watch("$ctrl.field",function(newValue,oldValue){vm.field=newValue},!0),vm.watchForWorkIdChange&&$scope.$watch(angular.bind(workitemdata,function(){return this.workId}),function(newVal,oldVal){void 0!==newVal&&""!==newVal&&newVal!==oldVal&&getField(newVal,vm.taskId,vm.fieldId)},!0),$scope.$watch(angular.bind(vm.workId,function(){return vm.workId}),function(newVal,oldVal){void 0!==newVal&&""!==newVal&&newVal!==oldVal&&($scope.workId=newVal,getField(newVal,vm.taskId,vm.fieldId))},!0),$scope.$watch(angular.bind(vm.fieldId,function(){return vm.fieldId}),function(newVal,oldVal){if(void 0!==newVal&&""!==newVal&&newVal!==oldVal){if($scope.fieldId=newVal,!vm.workId)return;$scope.field=null,getField(vm.workId,vm.taskId,newVal)}},!0),service};var spinCounter=0}angular.module("e5Anywhere").component("e5Field",{transclude:!0,bindings:{watchForWorkIdChange:"@",workId:"=",taskId:"=",fieldId:"=",fieldIn:"="},template:'<div class="field" style="padding:0 15px 10px 0" data-ng-field-data-type="field.fieldDataType" ng-if="field" data-ng-switch on="field.fieldDataType"> <label class="e5-label" for="{{field.workFieldId}}" ng-bind="field.label"></label> <input data-ng-switch-when="2" class="form-control k-input e5-input" id="{{field.workFieldId}}" kendo-date-picker ng-disabled="field.isReadOnly" ng-model="field.resolvedValue" ng-change="onChange(field)" ng-required="field.isRequired" tooltip="{{field.tooltip}}" /> <input data-ng-switch-when="11" class="form-control k-input e5-input" id="{{field.workFieldId}}" kendo-date-time-picker ng-disabled="field.isReadOnly" ng-model="field.resolvedValue" ng-change="onChange(field)" ng-required="field.isRequired" tooltip="{{field.tooltip}}" /> <input data-ng-switch-when="9|10" ng-switch-when-separator="|" style="display: inline;" class="form-control k-input e5-input" id="{{field.workFieldId}}" kendo-numeric-text-box k-format="c0" ng-disabled="field.isReadOnly" data-min="field.rangeMinimum" data-max="field.rangeMaximum" validationMessage="field.validationMessage"  ng-model="field.resolvedValue" ng-change="onChange(field)" ng-required="field.isRequired" tooltip="{{field.tooltip}}" /> <input data-ng-switch-when="7" class="form-control k-input e5-input" id="{{field.workFieldId}}" ng-disabled="field.isReadOnly" ng-model="field.resolvedValue" ng-change="onChange(field)" ng-required="field.isRequired" tooltip="{{field.tooltip}}" /> <input data-ng-switch-default class="form-control k-input k-textbox e5-input" id="{{field.workFieldId}}" type="text" ng-disabled="field.isReadOnly" pattern="{{field.pattern}}" validationMessage="field.validationMessage" ng-model="field.resolvedValue" ng-change="onChange(field)" ng-required="field.isRequired" tooltip="{{field.tooltip}}" /> <span data-ng-switch-when="14" class="e5-input-checkbox-span" >    <input class="form-control k-input" id="{{field.workFieldId}}" kendo-mobile-switch type="checkbox" ng-disabled="field.isReadOnly" ng-model="field.resolvedValue" k-on-label="\'YES\'" k-off-label="\'NO\'" ng-change="onChange(field)" ng-required="field.isRequired" tooltip="{{field.tooltip}}" /> </span> <textarea data-ng-switch-when="6" class="form-control k-input e5-input e5-input-textarea" id="{{field.workFieldId}}" ng-disabled="field.isReadOnly" ng-model="field.resolvedValue" ng-change="onChange(field)" ng-required="field.isRequired" tooltip="{{field.tooltip}}"></textarea></div>',controller:"e5FieldController"}).controller("e5FieldController",e5FieldController),e5FieldController.$inject=["$scope","$rootScope","$http","fielddata","workitemdata","ngToast","$translate","e5Endpoints","e5UtilsService","e5EventhubService"]}(),function(){function e5FieldSetController($scope,$rootScope,fielddata,workitemdata,ngToast,$translate){function activate(){$scope.workId=vm.workId,$scope.taskId=vm.taskId,$scope.fieldSetId=vm.fieldSetId,"task"==vm.fieldSetType?$scope.taskIdRequired=!0:$scope.taskIdRequired=!1,getFields(vm.workId,vm.taskId,vm.fieldSetId)}function getFields(workId,taskId,fieldSetId){$scope.fields=[],workId&&($scope.taskIdRequired||fieldSetId)&&($scope.taskIdRequired&&!taskId||(taskId||(taskId=""),fieldSetId||(fieldSetId=""),toggleSpinner(1),fielddata.getField(workId,taskId,void 0,fieldSetId).then(function(fieldResponse){$scope.fields=fieldResponse.data},function(response){ngToast.danger({content:$translate.instant("Failed to get field values")})}).finally(function(){toggleSpinner(-1)})))}function toggleSpinner(counterIncrementDecrement){if(void 0===spinCounter&&(spinCounter=0),spinCounter+=counterIncrementDecrement,1===counterIncrementDecrement&&1===spinCounter){if(!$("[ng-controller]"))return;kendo.ui.progress($("[ng-controller]"),!0)}if(-1===counterIncrementDecrement&&0===spinCounter){if(!$("[ng-controller]"))return;kendo.ui.progress($("[ng-controller]"),!1)}}var vm=this;vm.$onInit=function(){var service={activate:activate,getFields:getFields,toggleSpinner:toggleSpinner,spinCounter:spinCounter};return activate(),vm.watchForWorkIdChange&&$scope.$watch(angular.bind(workitemdata,function(){return this.workId}),function(newVal,oldVal){void 0!==newVal&&""!==newVal&&newVal!==oldVal&&getFields(newVal,vm.taskId,vm.fieldSetId)},!0),$scope.$watch(angular.bind(vm.workId,function(){return vm.workId}),function(newVal,oldVal){void 0!==newVal&&""!==newVal&&newVal!==oldVal&&($scope.workId=newVal,getFields(newVal,vm.taskId,vm.fieldSetId))},!0),$scope.$watch(angular.bind(vm.taskId,function(){return vm.taskId}),function(newVal,oldVal){void 0!==newVal&&""!==newVal&&newVal!==oldVal&&($scope.taskId=newVal,getFields(vm.workId,newVal,vm.fieldSetId))},!0),$scope.$watch(angular.bind(vm.fieldSetId,function(){return vm.fieldSetId}),function(newVal,oldVal){void 0!==newVal&&""!==newVal&&newVal!==oldVal&&($scope.fieldSetId=newVal,getFields(vm.workId,vm.taskId,newVal))},!0),$scope.$watch(angular.bind(vm.fieldSetType,function(){return vm.fieldSetType}),function(newVal,oldVal){void 0!==newVal&&""!==newVal&&newVal!==oldVal&&($scope.fieldSetType=newVal,"task"==$scope.fieldSetType?$scope.taskIdRequired=!0:$scope.taskIdRequired=!1,getFields(vm.workId,vm.taskId,newVal))},!0),service};var spinCounter=0}angular.module("e5Anywhere").component("e5FieldSet",{transclude:!0,bindings:{watchForWorkIdChange:"@",fieldSetType:"=",workId:"=",taskId:"=",fieldSetId:"="},template:'<div class="fields" style="padding:0 15px 10px 0" ng-repeat="field in fields"> <e5-field field-in="field"></e5-field></div>',controller:e5FieldSetController}),e5FieldSetController.$inject=["$scope","$rootScope","fielddata","workitemdata","ngToast","$translate"]}(),function(){function e5TaskController($scope,$rootScope,$http,$location,taskdata,fielddata,workitemdata,ngToast,$translate,$element,$attrs,endpoints,util){function activate(){void 0!==workitemdata.workId&&""!==workitemdata.workId&&(myWorkId=workitemdata.workId),void 0!==$scope.taskIdIn&&""!==$scope.taskIdIn&&(taskId=$scope.taskIdIn),spinCounter=0,"1"===queryStringParam("GetNext")||workitemdata.isGetNext?$scope.isGetNext=!0:$scope.isGetNext=!1,""===myWorkId||$scope.isGetNext?getNextWorkId():void 0===$scope.taskIdIn?getAllTasks():($scope.hidetaskpanel=!0,getTaskAndFields())}function saveTask(){if($scope.e5TaskForm.$valid){var changes=getKeyValueChanges(),data=JSON.stringify(changes);toggleSpinner(1);var workId=$scope.workIdIn||myWorkId;taskdata.save(workId,$scope.task.id,data).then(function(response){$scope.e5TaskForm.$setPristine(),getAllTasks()},function(response){ngToast.danger({content:$translate.instant("Failed to save field values")})}).finally(function(){toggleSpinner(-1)})}}function completeTask(){if($scope.e5TaskForm.$valid){var changes=getKeyValueChanges(),data=JSON.stringify(changes);toggleSpinner(1);var workId=$scope.workIdIn||myWorkId;taskdata.complete(workId,$scope.task.id,data).then(function(response){if(response.data&&$scope.isGetNext){var previousWorkItemId=$scope.task.workId;if(workItemUnlock(),getNextWorkId(),previousWorkItemId!==workitemdata.workId&&void 0!==$attrs.getnextredirect&&"true"===$attrs.getnextredirect){var newUrl=setNewQueryStringParam(window.location.href,"workId",workitemdata.workId);newUrl=setNewQueryStringParam(newUrl,"GetNext","1"),window.location.replace(newUrl)}getAllTasks()}else getAllTasks()},function(response){ngToast.danger({content:$translate.instant("Failed to complete task")})}).finally(function(){toggleSpinner(-1)})}}function workItemUnlock(fireInOnUnload){if(fireInOnUnload){var xhr=new XMLHttpRequest;xhr.withCredentials=!0,xhr.open("PUT",String.format(endpoints.workitemUnlockRoute,myWorkId),!1),xhr.setRequestHeader("Content-type","application/json"),xhr.send("{}")}else workitemdata.unlock(myWorkId).then(function(response){},function(response){ngToast.danger({content:$translate.instant("Error while unlocking the work item")})})}function onPanelItemSelect(e){void 0!==(taskId=$(e.item).children().children(".panelItemTaskLink").attr("task-id"))&&$scope.selectedTaskId!==taskId&&($scope.selectedTaskId=taskId,$scope.tasks.forEach(function(task){task.id===taskId&&($scope.task=task,$scope.$parent&&($scope.$parent.task=$scope.task),$scope.taskDescription=$scope.task.description,$scope.$apply())}))}function getNextWorkId(){toggleSpinner(1),workitemdata.getNext().then(function(response){myWorkId=response.data,workitemdata.workId=myWorkId,getAllTasks()},function(response){ngToast.danger({content:$translate.instant("Failed to get next work item")})}).finally(function(){toggleSpinner(-1)})}function getAllTasks(){$scope.hasDueTasks=!1,$scope.taskDescription="",toggleSpinner(1),taskdata.getTasks($scope.workIdIn||myWorkId,!1).then(function(response){$scope.tasks=response.data;var firstDueTask=null;$scope.dueTasks=[],$scope.completeTasks=[],$scope.tasks.forEach(function(task){null===task.completionDate?(null===firstDueTask&&(firstDueTask=task.id,$scope.task=task,$scope.$parent&&($scope.$parent.task=$scope.task),$scope.taskDescription=task.description,$scope.taskDescription=task.description),$scope.dueTasks.push({encoded:!1,text:"<span class='panelItemTaskLink' task-id='"+task.id+"'>"+task.name+"</span>"})):$scope.completeTasks.push({encoded:!1,text:"<span class='panelItemTaskLink' task-id='"+task.id+"'>"+task.name+"</span>"}),taskId=task.id}),null!==firstDueTask?(taskId=firstDueTask,$scope.hasDueTasks=!0):($scope.hasDueTasks=!1,$scope.taskDescription=$translate.instant("No due tasks"),$scope.task=null,$scope.fields=null),$("#taskPanelBar").kendoPanelBar({dataSource:[{text:$translate.instant("Complete"),expanded:!$scope.hasDueTasks,items:$scope.completeTasks},{text:$translate.instant("Due"),expanded:!0,items:$scope.dueTasks}]}),$scope.task?$scope.classification={category1Id:$scope.task.category1Id,category2Id:$scope.task.category2Id,category3Id:$scope.task.category3Id}:$scope.classification={category1Id:0,category2Id:0,category3Id:0},$scope.classificationDataLoaded=!0}).finally(function(){toggleSpinner(-1),$("#taskPanelBar").data("kendoPanelBar").bind("select",onPanelItemSelect),$scope.hasDueTasks||workItemUnlock()})}function getTaskAndFields(){toggleSpinner(1);var $q=angular.injector(["ng"]).get("$q"),workId=$scope.workIdIn||myWorkId;if(taskId){var requests=[taskdata.getTask(workId,taskId,!0)];$q.all(requests).then(function(responses){responses.forEach(function(response){-1!==response.config.url.indexOf("/Task")&&($scope.tasks=response.data)}),$scope.task=$scope.tasks[0],$scope.$parent&&($scope.$parent.task=$scope.task),$scope.taskDescription=$scope.task.description,$scope.classification={category1Id:$scope.task.category1Id,category2Id:$scope.task.category2Id,category3Id:$scope.task.category3Id},$scope.classificationDataLoaded=!0,populateLists()}).finally(function(){toggleSpinner(-1)})}}function getKeyValueChanges(){var fieldData={};return angular.forEach($scope.e5TaskForm.$$controls,function(value,key){if("object"==typeof value&&value.$dirty){var fieldkey=value.$$element[0].id,fieldvalue=value.$viewValue;fieldData[fieldkey]=fieldvalue}}),fieldData}function toggleSpinner(counterIncrementDecrement){if(void 0===spinCounter&&(spinCounter=0),spinCounter+=counterIncrementDecrement,1===counterIncrementDecrement&&1===spinCounter){if(!$("[ng-controller]"))return;kendo.ui.progress($("[ng-controller]"),!0)}if(-1===counterIncrementDecrement&&0===spinCounter){if(!$("[ng-controller]"))return;kendo.ui.progress($("[ng-controller]"),!1)}}this.$onInit=function(){var service={activate:activate,saveTask:saveTask,completeTask:completeTask,workItemUnlock:workItemUnlock,onPanelItemSelect:onPanelItemSelect,getNextWorkId:getNextWorkId,getAllTasks:getAllTasks,getTaskAndFields:getTaskAndFields,getKeyValueChanges:getKeyValueChanges,toggleSpinner:toggleSpinner,spinCounter:spinCounter};return activate(),$scope.hidetaskpanel="undefined"!=typeof hideTaskPanel&&hideTaskPanel,$scope.classificationDataLoaded=!1,$scope.saveTaskOnClick=saveTask,$scope.completeTaskOnClick=completeTask,$scope.getNextOnClick=getNextWorkId,$scope.$parent&&($scope.$parent.saveTaskOnClick=saveTask,$scope.$parent.completeTaskOnClick=completeTask,$scope.$parent.task=$scope.task),$attrs.watchForWorkIdChange&&$scope.$watch(angular.bind(workitemdata,function(){return this.workId}),function(newVal,oldVal){void 0!==newVal&&""!==newVal&&newVal!==oldVal&&getAllTasks()},!0),window.onbeforeunload=function(event){if($scope.e5TaskForm.$dirty){var message=$translate.instant("If you leave this page you will lose all unsaved changes, are you sure you want to leave?");return void 0===event&&(event=window.event),event&&(event.returnValue=message),message}},window.onunload=function(event){workItemUnlock(!0)},$scope.$on("$destroy",function(){delete window.onbeforeunload}),service};var spinCounter=0,myWorkId="",taskId=""}var templateUrl="";$("script").each(function(){return this.src.length<200&&-1!==this.src.indexOf("/dist/js/e5anywhere.angular.all.js")?(templateUrl=this.src.replace("/js/e5anywhere.angular.all.js","/templates/e5.task.template.html"),!1):this.src.length<200&&-1!==this.src.indexOf("/conversation/e5.conversation.view.component.js")?(templateUrl=this.src.replace("e5.task.component.js","e5.task.template.html"),!1):void 0}),""===templateUrl&&(templateUrl="/Web/dist/templates/e5.task.template.html"),angular.module("e5Anywhere").filter("trust",["$sce",function($sce){return function(htmlCode){return $sce.trustAsHtml(htmlCode)}}]).component("e5Task",{transclude:!0,bindings:{watchForWorkIdChange:"@",showclassification:"@",getnextredirect:"@",workIdIn:"=workId",taskIdIn:"=taskId",hideTaskPanel:"@"},templateUrl:templateUrl,controller:e5TaskController}),e5TaskController.$inject=["$scope","$rootScope","$http","$location","taskdata","fielddata","workitemdata","ngToast","$translate","$element","$attrs","e5Endpoints","e5UtilsService"]}(),function(){function e5ConversationViewController($sce,$scope,$timeout,$rootScope,$http,e5Config,$location,e5UtilsService,settingsdata,conversationdata,ngToast,$translate,$element,$attrs,endpoints,$sessionStorage){function activate(){model.localSettings={},model.localSettings.showNewConversation=!1,model.localSettings.showNewYammerPost=!1,$scope.to="",$scope.from=$scope.from||"esaunders@e5workflow.com",$scope.defaultTemplate=$scope.defaultTemplate||"default.xslt",$scope.defaultTemplateOriginal&&($scope.defaultTemplate=$scope.defaultTemplateOriginal),$scope.cc="",$scope.bcc="",$scope.subject="",$scope.threadId="",$scope.showAttachments=!0,$scope.showTemplates=!0,$scope.onSentData={},$scope.dateNow=new Date,$scope.onSent=function($email){localStorageCurrentWork.localSettings.showNewConversation=!1,localStorageCurrentWork.localSettings.newTo="",localStorageCurrentWork.localSettings.newSubject="",localStorageCurrentWork.localSettings.newBody="",localStorageCurrentWork.localSettings.originalBodyHtml="",localStorageCurrentWork.localSettings.originalBodyHtmlMessageId="",model.localSettings=localStorageCurrentWork.localSettings,ngToast.success({content:$translate.instant("Email successfully sent")})},$scope.onReplySent=function(replyMessage){replyMessage.replyBody="",replyMessage.ShowReply=!1,localStorageCurrentWork.localSettings.newTo="",localStorageCurrentWork.localSettings.newSubject="",localStorageCurrentWork.localSettings.newBody="",localStorageCurrentWork.localSettings.originalBodyHtml="",localStorageCurrentWork.localSettings.originalBodyHtmlMessageId="",model.localSettings=localStorageCurrentWork.localSettings,ngToast.success({content:$translate.instant("Email successfully sent")})},$scope.$storage=$sessionStorage,workId||(workId=e5UtilsService.resolveWorkId(),$scope.workId=workId),void 0!==$scope.$storage.work&&null!==$scope.$storage.work||($scope.$storage.work=[{workId:workId}]),localStorageCurrentWork=$.grep($scope.$storage.work,function(e){return e.workId==workId})[0],void 0!==localStorageCurrentWork&&null!==localStorageCurrentWork||($scope.$storage.work.push({workId:workId}),localStorageCurrentWork=$.grep($scope.$storage.work,function(e){return e.workId==workId})[0]),void 0!==localStorageCurrentWork.localSettings&&null!==localStorageCurrentWork.localSettings&&(model.localSettings=localStorageCurrentWork.localSettings,$scope.defaultTemplateOriginal||($scope.defaultTemplateOriginal=$scope.defaultTemplate),$scope.defaultTemplate=""),void 0!==localStorageCurrentWork.conversations&&null!==localStorageCurrentWork.conversations?(model.conversations=localStorageCurrentWork.conversations,conversationdata.getConversation(workId).then(function(response){var newData=response.data.conversations;if(model.conversations||newData)refreshComponent();else if(model.conversations.length!==newData.length)refreshComponent(),ngToast.info({content:$translate.instant("New message found - Refreshing conversation")});else for(var k=0;k<newData.length;k++)model.conversations[k].messages.length!==newData[k].messages.length&&(refreshComponent(),ngToast.info({content:$translate.instant("New message found - Refreshing conversation")}))},function(response){}).finally(function(){})):conversationdata.getConversation(workId).then(function(response){model.conversations=response.data.conversations,localStorageCurrentWork.conversations=model.conversations},function(response){ngToast.danger({content:$translate.instant("Failed to get conversation data")})}).finally(function(){setTimeout(function(){insertInlineImages()},500)})}function refreshComponent(){localStorageCurrentWork.conversations=null,localStorageCurrentWork.localSettings=null,activate()}function trustHtml(html){return $sce.trustAsHtml(html)}function FixImageWidth(bodyhtml){try{var $newBody=$(bodyhtml);return $newBody.find("img").each(function(index){if(void 0!==$(this).attr("width")&&null!==$(this).attr("width")){var originalWidth=$(this).attr("width");originalWidth&&-1===originalWidth.indexOf("px")&&(originalWidth+="px"),$(this).removeAttr("width"),$(this).removeAttr("height"),$(this).css({height:"",width:"100%","max-width":originalWidth})}}),$newBody.wrapAll($("<div/>")).parent().html()}catch(err){return bodyhtml}}function stripData(bodyhtml){try{return bodyhtml.replace(/!important/gi,"")}catch(err){return bodyhtml}}function ExtractImageIdentifiers(bodyhtml){var imgIndentifiers=[];return $(bodyhtml).find("img").each(function(index){$(this).attr("src")&&-1!==$(this).attr("src").indexOf("cid:")&&imgIndentifiers.push($(this).attr("src"))}),imgIndentifiers}function ReplaceBodyWithBase64Images(bodyHtml,bodyMhtml){for(var cidImageData=getCidImageData(bodyHtml,bodyMhtml),k=0;k<cidImageData.length;k++)cidImageData[k].data.length>0&&(bodyHtml=bodyHtml.replace(new RegExp("src='"+cidImageData[k].cid,"gi"),"originalCid='"+cidImageData[k].cid+"' src='data:image/"+cidImageData[k].ext+";base64,"+cidImageData[k].data),bodyHtml=bodyHtml.replace(new RegExp('src="'+cidImageData[k].cid,"gi"),"originalCid='"+cidImageData[k].cid+"' src=\"data:image/"+cidImageData[k].ext+";base64,"+cidImageData[k].data),bodyHtml=bodyHtml.replace(new RegExp("src="+cidImageData[k].cid,"gi"),"originalCid='"+cidImageData[k].cid+"' src=data:image/"+cidImageData[k].ext+";base64,"+cidImageData[k].data));return bodyHtml}function getCidImageData(bodyHtml,bodyMhtml){
for(var cidImageData=[],lines=bodyMhtml.split("\n"),regexPatternForImageIdentifier="Content-ID: <image001.jpg@01D1EF03.91CC22F0>",imgIndentifiers=ExtractImageIdentifiers(bodyHtml),k=0;k<imgIndentifiers.length;k++){regexPatternForImageIdentifier="Content-ID: <"+imgIndentifiers[k].replace("cid:","")+">";var tmp1=imgIndentifiers[k].split("@")[0],tmp2=tmp1.split("."),imgExtension=tmp2[tmp2.length-1];imgExtension.length>4&&(imgExtension="png");for(var base64Image=[],base64ImageString="",imageExtracted=!1,imageIdentifierFound=!1,contentTransferEncodingFound=!1,endOfImageFound=!1,i=0;i<lines.length&&(imageExtracted&&!endOfImageFound&&lines[i].indexOf("----_=_NextPart1")>-1&&(endOfImageFound=!0),!endOfImageFound||!imageExtracted);i++)imageIdentifierFound&&contentTransferEncodingFound&&lines[i].length>0&&-1===lines[i].indexOf("Content-Transfer-Encoding:")&&(base64Image.push(lines[i]),imageExtracted=!0),!imageIdentifierFound&&lines[i].indexOf(regexPatternForImageIdentifier)>-1&&(imageIdentifierFound=!0),!contentTransferEncodingFound&&lines[i].indexOf("Content-Transfer-Encoding:")>-1&&(contentTransferEncodingFound=!0);base64ImageString=base64Image.join(""),cidImageData.push({cid:imgIndentifiers[k],ext:imgExtension,data:base64ImageString})}return cidImageData}function hasCidImages(str){return/src=['""]cid:/g.test(str)}function AttachmentViewerUrl(workId,source,attachmentString){return void 0!==queryStringParam("source")&&null!==queryStringParam("source")&&queryStringParam("source").length>0&&(source=queryStringParam("source")),RetrieveAttachmentViewerUrl(workId,source,attachmentString,void 0,void 0,void 0,e5Config.e5LegacyBase)}function insertInlineImages(sender){var elements;elements=void 0===sender||null===sender?$(document).find(".messageBlock:visible"):sender.find(".messageBlock"),elements.each(function(){var workId=$(this).attr("workId");$scope.workId=workId;var conversationId=$(this).attr("conversationId"),messageId=$(this).attr("messageId"),conversation=model.conversations[conversationId];if(void 0===conversation||null===conversation)return!0;var message=$.grep(conversation.messages,function(e){return e.id==messageId})[0];if(void 0===message||null===message)return!0;hasCidImages(message.bodyHtml)&&conversationdata.getUniqueEmailAsMhtml(workId,messageId).then(function(response){message.bodyHtml=ReplaceBodyWithBase64Images(message.bodyHtml,response.data),message.bodyHtml=FixImageWidth(message.bodyHtml),message.bodyHtml=stripData(message.bodyHtml)},function(response){}).finally(function(){})})}function saveCollapseState(){$(document).find(".conversationBlock:hidden").each(function(){var conversationId=$(this).attr("conversationId"),conversation=model.conversations[conversationId];if(void 0===conversation||null===conversation)return!0;model.conversations[conversationId].showConversation=!1}),$(document).find(".conversationBlock:visible").each(function(){var conversationId=$(this).attr("conversationId"),conversation=model.conversations[conversationId];if(void 0===conversation||null===conversation)return!0;model.conversations[conversationId].showConversation=!0}),$(document).find(".messageBlock:hidden").each(function(){var conversationId=$(this).attr("conversationId"),messageId=$(this).attr("messageId"),conversation=model.conversations[conversationId];if(void 0===conversation||null===conversation)return!0;var message=$.grep(conversation.messages,function(e){return e.id==messageId})[0];if(void 0===message||null===message)return!0;message.showMessage=!1}),$(document).find(".messageBlock:visible").each(function(){var conversationId=$(this).attr("conversationId"),messageId=$(this).attr("messageId"),conversation=model.conversations[conversationId];if(void 0===conversation||null===conversation)return!0;var message=$.grep(conversation.messages,function(e){return e.id==messageId})[0];if(void 0===message||null===message)return!0;message.showMessage=!0}),localStorageCurrentWork.conversations=model.conversations,$scope.$apply()}function newConversation(){model.localSettings.showNewConversation=!model.localSettings.showNewConversation,localStorageCurrentWork.localSettings=model.localSettings}function newYammerPostOnClick(){model.localSettings.showNewYammerPost=!model.localSettings.showNewYammerPost,localStorageCurrentWork.localSettings=model.localSettings}function showReply(message,mode){if(!1===message.HideReplyNoInit)$scope.replyMode===mode&&(message.HideReplyNoInit=!0),void 0===$scope.replyMode&&message.ShowReply&&(message.HideReplyNoInit=!0);else{for(var k=0;k<model.conversations.length;k++)for(var i=0;i<model.conversations[k].messages.length;i++)model.conversations[k].messages[i].HideReplyNoInit=!0;message.HideReplyNoInit=!1}message.ShowReply=!0}function replyEmail(conversation,message,mode){if($scope.defaultTemplateOriginal&&($scope.defaultTemplate=$scope.defaultTemplateOriginal),model.localSettings.originalBodyHtmlMessageId&&model.localSettings.originalBodyHtmlMessageId===message.id)showReply(message,mode);else{var newReplyBodyHtml="<br/><br/><div class='replyEmailEnd' style='width:98%;padding:3pt 0 0 0;border-style:solid none none none;border-top-width:1pt;border-top-color:#B5C4DF;' >&nbsp;</div>"+message.replyBodyHtml;if(message.replyBodyHtml="",$("img[originalCid]").each(function(){var cid=$(this).attr("originalCid"),src=$(this).attr("src");newReplyBodyHtml=newReplyBodyHtml.replace(new RegExp("src='"+cid,"gi"),"originalCid='"+cid+"' src='"+src),newReplyBodyHtml=newReplyBodyHtml.replace(new RegExp('src="'+cid,"gi"),"originalCid='"+cid+"' src=\""+src),newReplyBodyHtml=newReplyBodyHtml.replace(new RegExp("src="+cid,"gi"),"originalCid='"+cid+"' src="+src)}),hasCidImages(newReplyBodyHtml)){for(var promises=[],j=0;j<conversation.messages.length;j++){var oMessage=conversation.messages[j];oMessage.id<=message.id&&promises.push(conversationdata.getUniqueEmailAsMhtml(workId,oMessage.id))}angular.injector(["ng"]).get("$q").all(promises).then(function(responses){responses.forEach(function(response){newReplyBodyHtml=ReplaceBodyWithBase64Images(newReplyBodyHtml,response.data),newReplyBodyHtml=FixImageWidth(newReplyBodyHtml),newReplyBodyHtml=stripData(newReplyBodyHtml)})},function(responses){}).finally(function(){model.localSettings.originalBodyHtml=newReplyBodyHtml,showReply(message,mode),$scope.$apply()})}else showReply(message,mode);model.localSettings.originalBodyHtml=newReplyBodyHtml,model.localSettings.originalBodyHtmlMessageId=message.id,localStorageCurrentWork.localSettings=model.localSettings}if(message.replyTo="",$scope.replyMode=mode,"reply"===mode||"all"===mode){if(message.messageType="reply",message.replyTo=message.from,"all"===mode){message.replyCc=message.cc.replace(/,/gi,";");var replyTo=(message.from+","+message.to).split(",").filter(function(value,index,self){return self.indexOf(value)===index});message.replyTo=replyTo.join(";")}else message.replyCc="";var re=$translate.instant("RE:");message.subject&&0===message.subject.indexOf(re)?message.replySubject=message.subject:message.replySubject=re+" "+message.subject,message.replyAttachments=[]}else{message.messageType="forward";var fw=$translate.instant("FWD:");message.subject&&0===message.subject.indexOf(fw)?message.replySubject=message.subject:message.replySubject=fw+" "+message.subject,message.replyAttachments=[],angular.forEach(message.attachments[0],function(value,key){"id"===key&&this.push(value)},message.replyAttachments)}localStorageCurrentWork.conversations=model.conversations}var localStorageCurrentWork,model=this,workId="";model.conversations=null,model.newConversationOnClick=newConversation,model.newYammerPostOnClick=newYammerPostOnClick,model.refreshComponentClick=refreshComponent,model.replyEmailOnClick=replyEmail,model.trustHtml=trustHtml,model.AttachmentViewerUrl=AttachmentViewerUrl,model.$onInit=function(){$scope.$watch("$ctrl.workId",function(newId,oldId){newId&&36===newId.length&&newId!==oldId&&(workId=newId,$scope.workId=newId,activate())}),this.workId&&36===this.workId.length&&(workId=this.workId),$scope.hasYammerFeedSet=function(newVal){$scope.hasYammerFeed=newVal},settingsdata.getSiteSettings().then(function(response){if(void 0!==response.data&&null!==response.data&&response.data.length>0&&void 0!==response.data[0].value&&null!==response.data[0].value){var settings=angular.fromJson(response.data[0].value);void 0!==settings.DefaultFromEmail&&null!==settings.DefaultFromEmail&&($scope.from=settings.DefaultFromEmail),void 0!==settings.DefaultEmailTemplate&&null!==settings.DefaultEmailTemplate&&($scope.defaultTemplate=settings.DefaultEmailTemplate),void 0!==settings.ShowYammerInConversationView&&null!==settings.ShowYammerInConversationView&&($scope.ShowYammerInConversationView=settings.ShowYammerInConversationView)}},function(responses){}).finally(function(){activate()})},$(document).on("hidden.bs.collapse",".k-panel",function(){setTimeout(function(){saveCollapseState()},200)}),$(document).on("show.bs.collapse",".k-panel",function(){setTimeout(function(){insertInlineImages(),saveCollapseState()},200)})}var templateUrl="";$("script").each(function(){return this.src.length<200&&-1!==this.src.indexOf("/dist/js/e5anywhere.angular.all.js")?(templateUrl=this.src.replace("/js/e5anywhere.angular.all.js","/templates/conversation.view.template.html"),!1):this.src.length<200&&-1!==this.src.indexOf("/conversation/e5.conversation.view.component.js")?(templateUrl=this.src.replace("e5.conversation.view.component.js","conversation.view.template.html"),!1):void 0}),""===templateUrl&&(templateUrl="/Web/dist/templates/conversation.view.template.html"),angular.module("e5Anywhere").component("e5ConversationView",{bindings:{workId:"="},templateUrl:templateUrl,controller:e5ConversationViewController}),e5ConversationViewController.$inject=["$sce","$scope","$timeout","$rootScope","$http","e5Config","$location","e5UtilsService","settingsdata","conversationdata","ngToast","$translate","$element","$attrs","e5Endpoints","$sessionStorage"]}(),function(){function e5YammerFeedController($sce,$scope,propertydata){function activate(workId){vm.hasYammerFeed=!1,toggleSpinner(1),propertydata.get(workId,"YammerFeedId",!1).then(function(response){var yammerFeedId=response.data.value;yammerFeedId&&(-1!==yammerFeedId.indexOf(",")&&(yammerFeedId=yammerFeedId.split(",")[0].trim()),$scope.yammerScript=$sce.trustAsHtml(String.format(vm.yammerScriptFormat,yammerFeedId)),vm.hasYammerFeed=!0,hasYammerFeedSet(!0),$scope.hideYammerFeed=!1)},function(response){}).finally(function(){toggleSpinner(-1)})}function toggleYammerFeed(){$scope.hideYammerFeed?$scope.hideYammerFeed=!1:$scope.hideYammerFeed=!0}function hasYammerFeedSet(newVal){$scope.hasYammerFeedSet&&$scope.hasYammerFeedSet(newVal),$scope.$parent.hasYammerFeedSet&&$scope.$parent.hasYammerFeedSet(newVal)}function toggleSpinner(counterIncrementDecrement){if(void 0===spinCounter&&(spinCounter=0),spinCounter+=counterIncrementDecrement,1===counterIncrementDecrement&&1===spinCounter){if(!$("[ng-controller]"))return;kendo.ui.progress($("[ng-controller]"),!0)}if(-1===counterIncrementDecrement&&0===spinCounter){if(!$("[ng-controller]"))return;kendo.ui.progress($("[ng-controller]"),!1)}}var vm=this;return vm.yammerScriptFormat='<script>                    yam.connect.embedFeed({                        "feedType": "topic",                        "feedId": "{0}",                        "config": {                            "use_sso": false,                            "header": false,                            "footer": false,                            "showOpenGraphPreview": false,                            "defaultToCanonical": false,                            "hideNetworkName": false                        },                        "container": "#embedded-feed"                    });                <\/script>',vm.$onInit=function(){vm.control={activate:activate,toggleYammerFeed:toggleYammerFeed},$scope.toggleYammerFeedOnClick=toggleYammerFeed,$scope.$watch("vm.workId",function(newId,oldId){newId&&36===newId.length&&newId!==oldId&&(vm.workId=newId,activate(newId))}),$scope.$watch(angular.bind(propertydata,function(){return this.yammerFeedId}),function(newVal,oldVal){void 0!==newVal&&""!==newVal&&newVal!==oldVal&&($scope.yammerScript=$sce.trustAsHtml(String.format(vm.yammerScriptFormat,newVal)),vm.hasYammerFeed=!0,hasYammerFeedSet(!0),$scope.hideYammerFeed=!1)},!0),activate(vm.workId)},vm;var spinCounter}angular.module("e5Anywhere").component("e5YammerFeed",{bindings:{workId:"=",hasYammerFeed:"="},controllerAs:"vm",template:'<div class="panel-group" id="conversation_yammer" ng-if="vm.hasYammerFeed">    <div class="panel panel-default">        <div class="panel-heading">            <a ng-click="toggleYammerFeedOnClick();">                <div class="conversationHeaderYammer">                    <img src="https://www.yammer.com/favicon.ico" /> Yammer Conversation                </div>            </a>        </div>        <div id="collapse_yammer" class="k-panel">            <div class="panel-body conversationBlock" conversationId="yammerConversation" ng-hide="hideYammerFeed">                <div id="embedded-feed" ng-hide="hideYammerFeed" style="height:500px;width:100%;"></div>                <span ng-bind-html="yammerScript"></span>            </div>        </div>    </div></div>',controller:"e5YammerFeedController"}).controller("e5YammerFeedController",e5YammerFeedController),e5YammerFeedController.$inject=["$sce","$scope","propertydata"]}(),function(){function e5YammerPostController($sce,$scope,$log,yammerdata,documentdata,workitemdata,propertydata,ngToast,$translate){function activate(workId){$scope.hideYammerPost=!1}function addYammerPost(){$scope.e5YammerForm.$valid&&(toggleSpinner(1),yammerdata.addPost(vm.workId,vm.Message).then(function(response){response.data[0].references&&response.data[0].references.forEach(function(reference){"topic"===reference.type&&(propertydata.yammerFeedId=reference.id)}),$scope.hideYammerPost=!0},function(response){ngToast.danger({content:$translate.instant("Failed to post yammer message.")})}).finally(function(){toggleSpinner(-1)}))}function toggleSpinner(counterIncrementDecrement){if(void 0===spinCounter&&(spinCounter=0),spinCounter+=counterIncrementDecrement,1===counterIncrementDecrement&&1===spinCounter){if(!$("[ng-controller]"))return;kendo.ui.progress($("[ng-controller]"),!0)}if(-1===counterIncrementDecrement&&0===spinCounter){if(!$("[ng-controller]"))return;kendo.ui.progress($("[ng-controller]"),!1)}}var vm=this;return vm.$onInit=function(){vm.control={activate:activate,addYammerPost:addYammerPost},$scope.addYammerPost=addYammerPost,activate(vm.workId)},vm;var spinCounter}angular.module("e5Anywhere").component("e5YammerPost",{bindings:{workId:"=",newTopicId:"="},controllerAs:"vm",template:'<div class="panel-group" id="yammerpost" ng-hide="hideYammerPost">    <div class="panel panel-default">        <div class="panel-heading">            <a>                <div class="conversationHeaderYammerPost">                    <img src="https://www.yammer.com/favicon.ico" /> New Yammer Post                </div>            </a>        </div>        <div id="collapse_yammerpost" class="k-panel">            <div class="panel-body conversationBlock" conversationId="yammerConversationPost" >                 <form id="e5YammerForm" class="e5YammerForm" name="e5YammerForm">                     <div class="e5Heading">{{"Message" | translate}}</div>                     <textarea class="k-textbox" type="textarea" name="Message" ng-model="vm.Message" required></textarea>                     <div><button id="addYammerPost" class="k-button send k-primary" ng-click="addYammerPost()">{{"Post Message" | translate}}</button></div>                  </form>            </div>        </div>    </div></div>',controller:"e5YammerPostController"}).controller("e5YammerPostController",e5YammerPostController),e5YammerPostController.$inject=["$sce","$scope","$log","yammerdata","documentdata","workitemdata","propertydata","ngToast","$translate"]}();